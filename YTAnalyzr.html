<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>YTAnalyzr - YouTube Analytics & Tools</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-color: #E53935; /* A slightly deeper, richer red */
      --primary-dark: #B71C1C;
      --primary-light: #FFCDD2; /* Softer light red */
      --accent-color: #2196F3; /* Vibrant blue */
      --text-primary: #212121;
      --text-secondary: #757575; /* Slightly darker secondary text */
      --divider-color: #E0E0E0;
      --background-color: #F5F5F5; /* Lighter background */
      --card-color: #FFFFFF;
      --status-bar-color: #C62828; /* Darker red for status bar */
      --bottom-nav-color: #FFFFFF;
      --ripple-color: rgba(0, 0, 0, 0.1);
      --success-color: #4CAF50;
      --warning-color: #FFC107;
      --error-color: #F44336;
      --info-color: #2196F3;
      --youtube-black: #282828;
      --card-shadow: 0 2px 4px rgba(0,0,0,0.1); /* Softer shadow */
      --hover-shadow: 0 6px 12px rgba(0,0,0,0.15); /* More pronounced hover */
    }

    .dark-mode {
      --primary-color: #FF5252; /* Brighter red for dark mode contrast */
      --primary-dark: #D32F2F;
      --primary-light: #420D0D;
      --accent-color: #64B5F6; /* Lighter blue for dark mode */
      --text-primary: #E0E0E0; /* Lighter text */
      --text-secondary: #B0B0B0; /* Muted secondary text */
      --divider-color: #424242; /* Darker divider */
      --background-color: #121212; /* Darkest background */
      --card-color: #212121; /* Darker card background */
      --status-bar-color: #000000;
      --bottom-nav-color: #1F1F1F; /* Slightly lighter than background */
      --ripple-color: rgba(255, 255, 255, 0.1);
      --youtube-black: #181818;
      --card-shadow: 0 2px 4px rgba(0,0,0,0.4);
      --hover-shadow: 0 6px 12px rgba(0,0,0,0.6);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      font-family: 'Roboto', sans-serif;
      background-color: var(--background-color);
      color: var(--text-primary);
      transition: background-color 0.3s, color 0.3s;
      overflow-x: hidden;
      position: relative;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* App Bar */
    .app-bar {
      background-color: #FFFFFF;
      color: var(--primary-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 16px;
      height: 56px;
      position: sticky;
      top: 0;
      z-index: 1000;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .app-title {
      font-size: px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 8px;
      letter-spacing: -0.5px;
    }

    .app-menu {
      display: flex;
      gap: 16px;
      align-items: center;
    }

    .theme-toggle {
      background: transparent;
      border: none;
      color: white;
      font-size: 20px;
      cursor: pointer;
    }

    /* Content Area */
    .app-content {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      padding-bottom: 72px; /* Space for bottom nav */
    }

    /* AdMob Style Banner */
    .admob-banner {
      width: 100%;
      height: 50px;
      background-color: var(--card-color);
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 16px 0;
      position: relative;
      overflow: hidden;
      color: var(--text-secondary);
      border: 1px solid var(--divider-color);
    }

    .admob-banner::before {
      content: "Ad";
      position: absolute;
      top: 2px;
      right: 4px;
      font-size: 10px;
      color: var(--text-secondary);
      background-color: #FFECB3;
      padding: 1px 4px;
      border-radius: 2px;
    }
    
    /* New style for rectangular ads */
    .admob-rectangle {
      width: 100%;
      height: 250px;
      background-color: var(--card-color);
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 16px 0;
      position: relative;
      overflow: hidden;
      color: var(--text-secondary);
      border: 1px solid var(--divider-color);
    }

    .admob-rectangle::before {
      content: "Ad";
      position: absolute;
      top: 2px;
      right: 4px;
      font-size: 10px;
      color: var(--text-secondary);
      background-color: #FFECB3;
      padding: 1px 4px;
      border-radius: 2px;
    }

    /* Search Bar */
    .search-container {
      position: relative;
      margin: 16px 0;
    }

    .search-input {
      width: 100%;
      background-color: var(--card-color);
      border: 1px solid var(--divider-color);
      padding: 12px 40px 12px 16px;
      font-size: 16px;
      color: var(--text-primary);
      border-radius: 24px;
      transition: border-color 0.3s, box-shadow 0.3s;
      height: 48px;
    }

    .search-input:focus {
      outline: none;
      border: 1px solid var(--primary-color);
      box-shadow: 0 0 0 1px var(--primary-light);
    }

    .search-icon {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-secondary);
      background: none;
      border: none;
      cursor: pointer;
    }

    /* Android Bottom Navigation */
    .bottom-nav {
      display: flex;
      justify-content: space-around;
      background-color: var(--bottom-nav-color);
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 56px;
      box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.1);
      z-index: 1000;
    }

    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      flex: 1;
      color: var(--text-secondary);
      transition: color 0.2s;
      padding: 8px 0;
      text-decoration: none;
      position: relative;
      overflow: hidden;
      font-size: 10px;
    }

    .nav-item.active {
      color: var(--primary-color);
    }

    .nav-item i {
      font-size: 20px;
      margin-bottom: 4px;
    }

    /* Material Cards */
    .material-card {
      background-color: var(--card-color);
      border-radius: 8px;
      overflow: hidden;
      box-shadow: var(--card-shadow);
      margin-bottom: 16px;
      transition: box-shadow 0.3s;
      position: relative;
    }

    .material-card:active {
      box-shadow: var(--hover-shadow);
    }

    .card-title {
      padding: 16px;
      font-size: 16px;
      font-weight: 500;
      color: var(--text-primary);
      border-bottom: 1px solid var(--divider-color);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .card-title-text {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .card-actions {
      display: flex;
      gap: 8px;
    }

    .card-content {
      padding: 16px;
      color: var(--text-secondary);
    }

    /* URL Input Container */
    .url-input-container {
      position: relative;
      margin-bottom: 16px;
      display: flex;
      flex-direction: column;
    }

    .url-input {
      width: 100%;
      background-color: var(--card-color);
      border: 1px solid var(--divider-color);
      padding: 12px 16px;
      font-size: 16px;
      color: var(--text-primary);
      border-radius: 4px;
      transition: border-color 0.3s;
      height: 48px;
      resize: none;
    }

    .url-input:focus {
      outline: none;
      border: 1px solid var(--primary-color);
    }

    .paste-btn {
      position: absolute;
      right: 8px;
      top: 8px;
      background-color: var(--primary-light);
      color: var(--primary-dark);
      border: none;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 14px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .paste-btn i {
      font-size: 14px;
    }

    /* Android Buttons */
    .material-btn {
      display: inline-block;
      background-color: var(--primary-color);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      font-size: 14px;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      transition: background-color 0.3s;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
      text-align: center;
    }

    .material-btn:hover {
      background-color: var(--primary-dark);
    }

    .material-btn-outlined {
      background-color: transparent;
      color: var(--primary-color);
      border: 1px solid var(--primary-color);
      box-shadow: none;
    }

    .material-btn-outlined:hover {
      background-color: rgba(255, 0, 0, 0.1);
    }

    .material-btn-text {
      background-color: transparent;
      color: var(--primary-color);
      box-shadow: none;
      padding: 8px 8px;
    }

    .material-btn-text:hover {
      background-color: rgba(255, 0, 0, 0.1);
    }

    /* Loading Progress */
    .progress-container {
      width: 100%;
      height: 4px;
      background-color: var(--primary-light);
      position: relative;
      overflow: hidden;
      display: none;
      margin-bottom: 16px;
    }

    .progress-bar {
      position: absolute;
      height: 100%;
      width: 50%;
      background-color: var(--primary-color);
      animation: progress 1.5s infinite ease-in-out;
    }

    @keyframes progress {
      0% { left: -50%; }
      100% { left: 100%; }
    }

    /* Toast Notification */
    .toast {
      position: fixed;
      bottom: 72px;
      left: 50%;
      transform: translateX(-50%);
      background-color: #323232;
      color: white;
      padding: 8px 16px;
      border-radius: 4px;
      font-size: 14px;
      z-index: 1050;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
      display: none;
      animation: fadeInOut 3s ease;
    }

    @keyframes fadeInOut {
      0%, 100% { opacity: 0; transform: translate(-50%, 20px); }
      10%, 90% { opacity: 1; transform: translate(-50%, 0); }
    }

    /* Feature Grid */
    .feature-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-bottom: 16px;
    }

    .feature-item {
      background-color: var(--card-color);
      border-radius: 8px;
      padding: 16px;
      display: flex;
      flex-direction: column;
      align-items: center;
      box-shadow: var(--card-shadow);
      transition: transform 0.3s, box-shadow 0.3s;
      cursor: pointer;
    }

    .feature-item:active {
      transform: scale(0.98);
      box-shadow: var(--hover-shadow);
    }

    .feature-icon {
      width: 48px;
      height: 48px;
      background-color: var(--primary-light);
      color: var(--primary-dark);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 8px;
    }

    .feature-icon i {
      font-size: 24px;
    }

    .feature-title {
      font-size: 14px;
      font-weight: 500;
      text-align: center;
      color: var(--text-primary);
    }

    /* Tags Container */
    .tags-container {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 16px;
    }

    .tag {
      background-color: var(--primary-light);
      color: var(--primary-dark);
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 4px;
      cursor: pointer;
    }

    .tag:active {
      background-color: var(--primary-color);
      color: white;
    }

    .tag i {
      font-size: 12px;
    }

    /* Results Container */
    .results-container {
      background-color: var(--card-color);
      border-radius: 8px;
      box-shadow: var(--card-shadow);
      margin-top: 16px;
      overflow: hidden;
      display: none;
    }

    .results-header {
      background-color: var(--primary-color);
      color: white;
      padding: 12px 16px;
      font-size: 16px;
      font-weight: 500;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .results-content {
      padding: 16px;
      padding-top: 0; /* Adjust for better spacing with the header */
    }

    .results-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
      margin-bottom: 16px;
      padding-top: 16px; /* Add padding here for results content */
    }

    .stat-item {
      background-color: var(--background-color);
      padding: 8px;
      border-radius: 4px;
      text-align: center;
    }

    .stat-value {
      font-weight: 500;
      font-size: 16px;
      color: var(--primary-color);
    }

    .stat-label {
      font-size: 12px;
      color: var(--text-secondary);
      margin-top: 4px;
    }

    .results-section {
      margin-bottom: 16px;
      padding-top: 16px;
    }

    .section-title {
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 8px;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-top: 1px solid var(--divider-color);
      padding-top: 16px; /* Separator for sections */
      margin-top: -16px; /* Compensate for padding */
    }

    .results-section:first-child .section-title {
        border-top: none;
        padding-top: 0;
    }

    .section-content {
      background-color: var(--background-color);
      padding: 12px;
      border-radius: 4px;
      font-size: 14px;
      color: var(--text-primary);
      position: relative;
      max-height: 200px;
      overflow-y: auto;
      white-space: pre-wrap;
      word-break: break-word;
    }

    .copy-btn {
      background-color: var(--primary-light);
      color: var(--primary-dark);
      border: none;
      width: 28px;
      height: 28px;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }

    /* Video Items (for search results/related videos) */
    .video-item {
      display: flex;
      margin-bottom: 16px;
      background-color: var(--card-color);
      border-radius: 8px;
      overflow: hidden;
      box-shadow: var(--card-shadow);
      cursor: pointer;
      position: relative;
    }

    .video-thumbnail {
      width: 160px;
      height: 90px;
      object-fit: cover;
      flex-shrink: 0;
    }

    .video-thumbnail.circle {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: cover;
      margin-right: 12px;
    }

    .video-duration {
      position: absolute;
      bottom: 8px;
      right: 8px;
      background-color: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 2px 4px;
      border-radius: 2px;
      font-size: 12px;
      font-weight: 500;
    }

    .video-type-icon {
      position: absolute;
      top: 8px;
      right: 8px;
      background-color: var(--primary-color);
      color: white;
      padding: 2px;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
    }

    .video-details {
      flex: 1;
      padding: 10px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .video-title {
      font-size: 14px;
      font-weight: 500;
      color: var(--text-primary);
      margin-bottom: 4px;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      line-height: 1.3;
    }

    .video-channel {
      font-size: 12px;
      color: var(--text-secondary);
      margin-bottom: 4px;
      display: flex;
      align-items: center;
    }

    .video-stats {
      display: flex;
      gap: 12px;
      font-size: 12px;
      color: var(--text-secondary);
    }

    .video-info-row {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }
    
    /* For new video player structure */
    .video-player-container {
      position: relative;
      width: 100%;
      margin-bottom: 16px;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: var(--card-shadow);
    }

    .video-player-container::before {
      content: "";
      display: block;
      padding-top: 56.25%; /* 16:9 Aspect Ratio */
    }

    .video-player {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border: none;
    }
    
    .video-meta-container {
      padding: 16px;
      border-bottom: 1px solid var(--divider-color);
    }

    .video-meta-title {
      font-size: 18px;
      font-weight: 500;
      margin-bottom: 12px;
      line-height: 1.3;
    }

    .channel-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .channel-info {
      display: flex;
      align-items: center;
    }

    .channel-name {
      font-weight: 500;
      font-size: 14px;
    }

    .subscribe-btn {
      background-color: var(--primary-color);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 18px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
    }

    .video-actions {
      display: flex;
      justify-content: space-between;
      border-bottom: 1px solid var(--divider-color);
      padding: 8px 16px;
    }

    .action-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      background: transparent;
      border: none;
      color: var(--text-primary);
      font-size: 12px;
      cursor: pointer;
      padding: 8px;
    }

    .action-btn i {
      font-size: 20px;
      margin-bottom: 4px;
    }

    .description-container {
      padding: 16px;
      font-size: 14px;
      line-height: 1.5;
      color: var(--text-primary);
      white-space: pre-wrap;
      margin-bottom: 16px;
    }

    .description-container.collapsed {
      max-height: 80px;
      overflow: hidden;
      position: relative;
    }

    .description-container.collapsed::after {
      content: "";
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 40px;
      background: linear-gradient(transparent, var(--card-color));
    }

    .show-more-btn {
      color: var(--accent-color);
      background: transparent;
      border: none;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      padding: 0 16px 16px;
      display: block;
    }

    /* Comments Section */
    .comment-item {
      margin-bottom: 16px;
      background-color: var(--card-color);
      border-radius: 8px;
      padding: 12px;
      box-shadow: var(--card-shadow);
    }

    .comment-header {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
    }

    .comment-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      margin-right: 8px;
    }

    .comment-author {
      font-size: 14px;
      font-weight: 500;
      color: var(--text-primary);
    }

    .comment-date {
      font-size: 12px;
      color: var(--text-secondary);
      margin-left: auto;
    }

    .comment-text {
      font-size: 14px;
      color: var(--text-primary);
      white-space: pre-wrap;
      word-break: break-word;
    }

    .comment-stats {
      display: flex;
      gap: 16px;
      margin-top: 8px;
      font-size: 12px;
      color: var(--text-secondary);
    }

    /* Tabs */
    .tabs-container {
      display: flex;
      border-bottom: 1px solid var(--divider-color);
      margin-bottom: 16px;
      overflow-x: auto;
      scrollbar-width: none;
    }

    .tabs-container::-webkit-scrollbar {
      display: none;
    }

    .tab {
      padding: 12px 16px;
      font-size: 14px;
      font-weight: 500;
      color: var(--text-secondary);
      cursor: pointer;
      white-space: nowrap;
      position: relative;
    }

    .tab.active {
      color: var(--primary-color);
    }

    .tab.active::after {
      content: '';
      position: absolute;
      bottom: -1px;
      left: 0;
      right: 0;
      height: 2px;
      background-color: var(--primary-color);
    }

    /* Tab Content */
    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* Modal */
    .modal-backdrop {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 1050;
      display: none;
    }

    .modal-container {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: var(--card-color);
      border-radius: 8px;
      width: 90%;
      max-width: 500px;
      max-height: 90%;
      overflow-y: auto;
      z-index: 1060;
      display: none;
      box-shadow: 0 3px 6px rgba(0, 0, 0, 0.16), 0 3px 6px rgba(0, 0, 0, 0.23);
    }

    .modal-header {
      padding: 16px;
      border-bottom: 1px solid var(--divider-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .modal-title {
      font-size: 18px;
      font-weight: 500;
      color: var(--text-primary);
    }

    .modal-close {
      background: none;
      border: none;
      color: var(--text-secondary);
      font-size: 24px;
      cursor: pointer;
    }

    .modal-body {
      padding: 16px;
    }

    .modal-footer {
      padding: 16px;
      border-top: 1px solid var(--divider-color);
      display: flex;
      justify-content: flex-end;
      gap: 8px;
    }

    /* Settings items */
    .settings-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px;
      border-bottom: 1px solid var(--divider-color);
    }

    .settings-item:last-child {
      border-bottom: none;
    }

    .settings-label {
      font-size: 16px;
      color: var(--text-primary);
    }

    .settings-description {
      font-size: 14px;
      color: var(--text-secondary);
      margin-top: 4px;
    }

    /* Toggle Switch */
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 40px;
      height: 20px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--divider-color);
      transition: .4s;
      border-radius: 20px;
    }

    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 16px;
      width: 16px;
      left: 2px;
      bottom: 2px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }

    input:checked + .toggle-slider {
      background-color: var(--primary-color);
    }

    input:checked + .toggle-slider:before {
      transform: translateX(20px);
    }

    /* Platform selector for AI generation tools */
    .platform-selector {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
    }

    .platform-item {
      flex: 1;
      background-color: var(--card-color);
      border: 1px solid var(--divider-color);
      padding: 8px;
      border-radius: 4px;
      text-align: center;
      cursor: pointer;
      font-size: 14px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }

    .platform-item.active {
      background-color: var(--primary-light);
      color: var(--primary-dark);
      border-color: var(--primary-color);
    }

    .platform-item i {
      font-size: 18px;
    }

    /* AI Output Container */
    .ai-output-container {
      margin-top: 16px;
    }

    .output-item {
      background-color: var(--background-color);
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 12px;
      position: relative;
    }

    .output-actions {
      display: flex;
      gap: 8px;
      margin-top: 8px;
    }

    /* Transcript Container */
    .transcript-container {
      background-color: var(--background-color);
      border-radius: 4px;
      padding: 12px;
      margin-top: 16px;
      max-height: 400px;
      overflow-y: auto;
      white-space: pre-wrap;
      font-size: 14px;
      line-height: 1.5;
      color: var(--text-primary);
    }

    .transcript-container .timestamp {
      color: var(--primary-color);
      font-weight: 500;
      margin-right: 8px;
    }

    .transcript-line {
      margin-bottom: 8px;
    }

    /* Loading Spinner */
    .spinner {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
      margin-right: 8px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Content Planner Styles */
    .content-planner-container {
      margin-top: 16px;
    }

    .planner-item {
      background-color: var(--card-color);
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 12px;
      box-shadow: var(--card-shadow);
      border-left: 4px solid var(--primary-color);
    }

    .planner-date {
      color: var(--text-secondary);
      font-size: 12px;
      margin-bottom: 4px;
    }

    .planner-title {
      font-weight: 500;
      font-size: 16px;
      color: var(--text-primary);
      margin-bottom: 8px;
    }

    .planner-description {
      color: var(--text-secondary);
      font-size: 14px;
      margin-bottom: 8px;
    }

    .planner-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-bottom: 8px;
    }

    .planner-tag {
      background-color: var(--primary-light);
      color: var(--primary-dark);
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 12px;
    }

    .planner-actions {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
    }

    .planner-status {
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
      margin-right: auto;
    }

    .status-planned {
      background-color: #E3F2FD;
      color: #1565C0;
    }

    .status-ready {
      background-color: #E8F5E9;
      color: #2E7D32;
    }

    .status-published {
      background-color: #FFF3E0;
      color: #E65100;
    }

    /* Calendar Grid */
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 4px;
      margin-bottom: 16px;
    }

    .calendar-header {
      text-align: center;
      font-weight: 500;
      font-size: 12px;
      color: var(--text-secondary);
      padding: 4px 0;
    }

    .calendar-day {
      aspect-ratio: 1/1;
      background-color: var(--card-color);
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      color: var(--text-primary);
      position: relative;
      box-shadow: var(--card-shadow);
    }

    .calendar-day.active {
      background-color: var(--primary-light);
      color: var(--primary-dark);
      font-weight: 500;
    }

    .calendar-day.has-content::after {
      content: "";
      position: absolute;
      bottom: 4px;
      width: 4px;
      height: 4px;
      border-radius: 50%;
      background-color: var(--primary-color);
    }

    /* Developer Info */
    .developer-info {
      background-color: var(--card-color);
      border-radius: 8px;
      padding: 16px;
      margin-top: 16px;
      box-shadow: var(--card-shadow);
    }

    .developer-header {
      display: flex;
      align-items: center;
      margin-bottom: 16px;
    }

    .developer-avatar {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      margin-right: 12px;
      background-color: var(--primary-light);
      color: var(--primary-dark);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
    }

    .developer-name {
      font-size: 18px;
      font-weight: 500;
      color: var(--text-primary);
    }

    .developer-title {
      font-size: 14px;
      color: var(--text-secondary);
    }

    .contact-item {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
      font-size: 14px;
      color: var(--text-primary);
    }

    .contact-item i {
      width: 24px;
      color: var(--primary-color);
      margin-right: 8px;
    }

    .contact-item a {
      color: var(--accent-color);
      text-decoration: none;
    }

    /* History Section */
    .history-container {
      margin-top: 16px;
    }

    .history-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .history-title {
      font-size: 16px;
      font-weight: 500;
      color: var(--text-primary);
    }

    .clear-history-btn {
      color: var(--primary-color);
      background: transparent;
      border: none;
      font-size: 14px;
      cursor: pointer;
    }

    .history-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
    }

    .history-item {
      background-color: var(--card-color);
      border-radius: 8px;
      overflow: hidden;
      box-shadow: var(--card-shadow);
      cursor: pointer;
    }

    .history-thumbnail {
      width: 100%;
      aspect-ratio: 16/9;
      object-fit: cover;
    }

    .history-details {
      padding: 8px;
    }

    .history-video-title {
      font-size: 12px;
      font-weight: 500;
      color: var(--text-primary);
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      margin-bottom: 4px;
      line-height: 1.2;
    }

    .history-channel-name {
      font-size: 10px;
      color: var(--text-secondary);
    }

    /* Revenue Calculator */
    .revenue-calculator-container {
      margin-top: 16px;
    }

    .revenue-result {
      background-color: var(--primary-light);
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 16px;
      text-align: center;
    }

    .revenue-amount {
      font-size: 36px;
      font-weight: 700;
      color: var(--primary-dark);
      margin-bottom: 8px;
    }

    .revenue-label {
      font-size: 14px;
      color: var(--primary-dark);
    }

    .revenue-range {
      font-size: 12px;
      color: var(--text-secondary);
      margin-top: 4px;
    }

    .revenue-breakdown {
      background-color: var(--card-color);
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: var(--card-shadow);
    }

    .revenue-breakdown-title {
      font-size: 16px;
      font-weight: 500;
      margin-bottom: 12px;
      color: var(--text-primary);
    }

    .revenue-breakdown-item {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid var(--divider-color);
    }

    .revenue-breakdown-item:last-child {
      border-bottom: none;
    }

    .revenue-breakdown-label {
      color: var(--text-secondary);
    }

    .revenue-breakdown-value {
      font-weight: 500;
      color: var(--text-primary);
    }

    /* Shorts Creator */
    .shorts-idea-container {
      background-color: var(--card-color);
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: var(--card-shadow);
      position: relative;
    }

    .shorts-idea-header {
      display: flex;
      align-items: center;
      margin-bottom: 12px;
    }

    .shorts-idea-icon {
      width: 36px;
      height: 36px;
      background-color: var(--primary-light);
      color: var(--primary-dark);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 12px;
    }

    .shorts-idea-title {
      font-size: 16px;
      font-weight: 500;
      color: var(--text-primary);
    }

    .shorts-idea-content {
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 12px;
      line-height: 1.5;
    }

    .shorts-idea-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 12px;
    }

    .shorts-idea-tag {
      background-color: var(--primary-light);
      color: var(--primary-dark);
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
    }

    .shorts-actions {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
    }

    /* Dynamic Image Panel */
    .dynamic-panel {
      width: 100%;
      aspect-ratio: 16 / 9; /* For a video-like aspect ratio */
      max-height: 250px; /* Limit height for rectangular ad replacement */
      margin: 16px auto;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);
      position: relative;
    }

    .dynamic-panel .slider img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 8px;
      transition: opacity 0.8s ease-in-out;
      position: absolute;
      top: 0;
      left: 0;
      opacity: 0;
    }

    .dynamic-panel .slider img.active {
      opacity: 1;
      z-index: 1;
    }

    /* Enhanced Mobile Controls */
    @media (max-width: 480px) {
      .feature-grid {
        grid-template-columns: repeat(3, 1fr);
      }
      
      .results-stats {
        grid-template-columns: repeat(3, 1fr);
      }
      
      .video-thumbnail {
        width: 120px;
        height: 67px;
      }
      
      .history-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      /* Specific adjustments for video player on small screens */
      .video-player-container {
        margin-bottom: 12px;
      }

      .video-meta-title {
        font-size: 16px;
        margin-bottom: 8px;
      }

      .channel-row {
        margin-bottom: 8px;
      }

      .channel-name {
        font-size: 13px;
      }

      .subscribe-btn {
        font-size: 12px;
        padding: 6px 12px;
      }

      .action-btn {
        font-size: 10px;
        padding: 6px;
      }

      .action-btn i {
        font-size: 18px;
        margin-bottom: 2px;
      }

      .description-container {
        padding: 12px;
        font-size: 13px;
      }

      .show-more-btn {
        padding: 0 12px 12px;
      }

    }
  </style>
</head>
<body>
  <!-- App Bar -->
  <div class="app-bar">
    <div class="app-title">
      <i class="fab fa-youtube"></i> YTAnalyzr
    </div>
    <div class="app-menu">
      <button class="search-icon" id="mainSearchBtn">
        <i class="fas fa-search"></i>
      </button>
    </div>
  </div>

  <!-- Main Content Area -->
  <div class="app-content">
    <!-- Home Screen -->
    <div id="home-screen" class="tab-content active">
      <!-- Ad Banner at the top -->
      <div class="admob-banner">
        <span>Advertisement</span>
      </div>
      
      <!-- Removed Search Container from Home Screen -->
      <!-- <div class="search-container">
        <input type="text" class="search-input" id="videoSearch" placeholder="Search videos or enter a video URL...">
        <button class="search-icon" id="searchButton">
          <i class="fas fa-search"></i>
        </button>
      </div> -->

      <!-- Replaced "Extract Data from Video" with Dynamic Panel -->
      <div class="dynamic-panel" id="mainImageSlider">
        <div class="slider">
          <img id="mainSlideImage" src="" alt="Promotion">
        </div>
      </div>

      <div class="progress-container" id="loadingProgress">
        <div class="progress-bar"></div>
      </div>

      <!-- History Section -->
      <div class="history-container" id="historyContainer">
        <div class="history-header">
          <div class="history-title"><i class="fas fa-history"></i> Recently Viewed</div>
          <button class="clear-history-btn" id="clearHistoryBtn">Clear All</button>
        </div>
        <div class="history-grid" id="historyGrid">
          <!-- History items will be generated here -->
        </div>
      </div>

      <div class="feature-grid">
        <!-- New feature item for Video Metadata Extraction -->
        <div class="feature-item" id="feature-extract-metadata">
          <div class="feature-icon">
            <i class="fas fa-database"></i>
          </div>
          <div class="feature-title">Video Metadata</div>
        </div>
        <div class="feature-item" id="feature-shorts">
          <div class="feature-icon">
            <i class="fas fa-bolt"></i>
          </div>
          <div class="feature-title">YouTube Shorts Creator</div>
        </div>
        <div class="feature-item" id="feature-revenue">
          <div class="feature-icon">
            <i class="fas fa-dollar-sign"></i>
          </div>
          <div class="feature-title">Revenue Calculator</div>
        </div>
        <div class="feature-item" id="feature-thumbnail">
          <div class="feature-icon">
            <i class="fas fa-image"></i>
          </div>
          <div class="feature-title">Download Thumbnail</div>
        </div>
        <div class="feature-item" id="feature-comments">
          <div class="feature-icon">
            <i class="fas fa-comments"></i>
          </div>
          <div class="feature-title">Video Comments</div>
        </div>
        <div class="feature-item" id="feature-keyword">
          <div class="feature-icon">
            <i class="fas fa-key"></i>
          </div>
          <div class="feature-title">Keyword Suggestions</div>
        </div>
        <!-- Consolidated AI tools into one feature item -->
        <div class="feature-item" id="feature-ai-tools">
          <div class="feature-icon">
            <i class="fas fa-brain"></i>
          </div>
          <div class="feature-title">AI Content Tools</div>
        </div>
        <div class="feature-item" id="feature-content-planner">
          <div class="feature-icon">
            <i class="fas fa-calendar-alt"></i>
          </div>
          <div class="feature-title">Content Planner</div>
        </div>
        <div class="feature-item" id="feature-transcript">
          <div class="feature-icon">
            <i class="fas fa-closed-captioning"></i>
          </div>
          <div class="feature-title">Get Transcript</div>
        </div>
        <div class="feature-item" id="feature-analytics">
          <div class="feature-icon">
            <i class="fas fa-chart-bar"></i>
          </div>
          <div class="feature-title">Video Analytics</div>
        </div>
        <div class="feature-item" id="feature-tag-generator">
          <div class="feature-icon">
            <i class="fas fa-tags"></i>
          </div>
          <div class="feature-title">Tag Generator</div>
        </div>
        <div class="feature-item" id="feature-idea-generator">
          <div class="feature-icon">
            <i class="fas fa-lightbulb"></i>
          </div>
          <div class="feature-title">Video Ideas</div>
        </div>
      </div>

      <div class="admob-banner">
        <span>Advertisement</span>
      </div>
    </div>
    
    <!-- New screen for Video Metadata Extraction -->
    <div id="metadata-extract-screen" class="tab-content">
      <div class="material-card">
        <div class="card-title">
          <div class="card-title-text">
            <i class="fas fa-database"></i> Video Metadata Extractor
          </div>
          <div class="card-actions">
            <button class="copy-btn" id="refreshMetadataExtractorBtn">
              <i class="fas fa-sync"></i>
            </button>
          </div>
        </div>
        <div class="card-content">
          <div class="url-input-container">
            <textarea class="url-input" id="videoUrl" placeholder="Paste YouTube video URL here" required></textarea>
            <button class="paste-btn" id="pasteUrlBtn">
              <i class="fas fa-paste"></i> Paste
            </button>
          </div>
          <button class="material-btn w-100" id="extractBtn">
            <i class="fas fa-search me-2"></i> Extract Metadata
          </button>
        </div>
      </div>
      
      <div class="progress-container" id="extractProgress">
        <div class="progress-bar"></div>
      </div>

      <!-- Metadata Results Container -->
      <div id="metadataResults" class="results-container">
        <div class="results-header">
          <span>Video Metadata</span>
          <div style="display: flex; gap: 8px;">
            <button class="copy-btn" onclick="exportMetadata()">
              <i class="fas fa-download"></i>
            </button>
            <button class="copy-btn" id="refreshMetadataResultsBtn">
              <i class="fas fa-sync"></i>
            </button>
          </div>
        </div>
        <div class="results-content">
          <img id="videoThumbnail" src="" alt="Video Thumbnail" style="width: 100%; border-radius: 4px; margin-bottom: 16px;">
          
          <div class="results-stats">
            <div class="stat-item">
              <div class="stat-value" id="videoViews">0</div>
              <div class="stat-label">Views</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" id="videoLikes">0</div>
              <div class="stat-label">Likes</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" id="videoComments">0</div>
              <div class="stat-label">Comments</div>
            </div>
          </div>

          <div class="results-section">
            <div class="section-title">
              <span>Title</span>
              <button class="copy-btn" onclick="copyToClipboard('videoTitle')">
                <i class="fas fa-copy"></i>
              </button>
            </div>
            <div class="section-content" id="videoTitle"></div>
          </div>

          <div class="results-section">
            <div class="section-title">
              <span>Channel</span>
              <button class="copy-btn" onclick="copyToClipboard('videoChannel')">
                <i class="fas fa-copy"></i>
              </button>
            </div>
            <div class="section-content" id="videoChannel"></div>
          </div>

          <div class="results-section">
            <div class="section-title">
              <span>Description</span>
              <button class="copy-btn" onclick="copyToClipboard('videoDescription')">
                <i class="fas fa-copy"></i>
              </button>
            </div>
            <div class="section-content" id="videoDescription"></div>
          </div>

          <div class="results-section">
            <div class="section-title">
              <span>Tags</span>
              <div style="display: flex; gap: 8px;">
                <button class="copy-btn" onclick="copyToClipboard('videoTags')">
                  <i class="fas fa-copy"></i>
                </button>
              </div>
            </div>
            <div class="tags-container" id="videoTagsContainer"></div>
            <div class="section-content" id="videoTags"></div>
          </div>

          <div class="results-section">
            <div class="section-title">Quick Actions</div>
            <div style="display: flex; gap: 8px; flex-wrap: wrap;">
              <button class="material-btn" onclick="viewComments()">
                <i class="fas fa-comments me-1"></i> View Comments
              </button>
              <button class="material-btn" onclick="getTranscript()">
                <i class="fas fa-closed-captioning me-1"></i> Get Transcript
              </button>
              <button class="material-btn" onclick="downloadThumbnail()">
                <i class="fas fa-image me-1"></i> Save Thumbnail
              </button>
              <button class="material-btn" onclick="generateAITitleFromMetadata()">
                <i class="fas fa-heading me-1"></i> AI Title
              </button>
              <button class="material-btn" onclick="generateAIDescriptionFromMetadata()">
                <i class="fas fa-paragraph me-1"></i> AI Description
              </button>
            </div>
          </div>
        </div>
      </div>
      <div class="admob-banner">
        <span>Advertisement</span>
      </div>
    </div>

    <!-- YouTube Shorts Creator Screen -->
    <div id="shorts-screen" class="tab-content">
      <div class="material-card">
        <div class="card-title">
          <div class="card-title-text">
            <i class="fas fa-bolt"></i> YouTube Shorts Creator
          </div>
          <div class="card-actions">
            <button class="copy-btn" id="refreshShortsBtn">
              <i class="fas fa-sync"></i>
            </button>
          </div>
        </div>
        <div class="card-content">
          <div class="url-input-container">
            <input type="text" class="url-input" id="shortsNiche" placeholder="Enter your niche (e.g., 'Fitness', 'Tech', 'Gaming')" required>
          </div>
          
          <div class="url-input-container">
            <select class="url-input" id="shortsCount">
              <option value="3">3 Ideas</option>
              <option value="5" selected>5 Ideas</option>
              <option value="10">10 Ideas</option>
            </select>
          </div>
          
          <button class="material-btn w-100" id="generateShortsBtn">
            <i class="fas fa-magic me-2"></i> Generate Shorts Ideas
          </button>
        </div>
      </div>

      <div class="progress-container" id="shortsProgress">
        <div class="progress-bar"></div>
      </div>

      <div id="shortsResults" class="results-container">
        <div class="results-header">
          <span>Shorts Ideas</span>
          <div style="display: flex; gap: 8px;">
            <button class="copy-btn" onclick="exportShortsIdeas()">
              <i class="fas fa-download"></i>
            </button>
            <button class="copy-btn" id="regenerateShortsBtn">
              <i class="fas fa-sync"></i>
            </button>
          </div>
        </div>
        <div class="results-content">
          <div id="shortsContainer">
            <!-- Generated shorts ideas will be loaded here -->
          </div>
        </div>
      </div>
      
      <!-- Replaced rectangular ad with Dynamic Panel -->
      <div class="dynamic-panel" id="shortsImageSlider">
        <div class="slider">
          <img id="shortsSlideImage" src="" alt="Promotion">
        </div>
      </div>
    </div>

    <!-- Revenue Calculator Screen -->
    <div id="revenue-screen" class="tab-content">
      <div class="material-card">
        <div class="card-title">
          <div class="card-title-text">
            <i class="fas fa-dollar-sign"></i> YouTube Revenue Calculator
          </div>
          <div class="card-actions">
            <button class="copy-btn" id="refreshRevenueBtn">
              <i class="fas fa-sync"></i>
            </button>
          </div>
        </div>
        <div class="card-content">
          <div class="url-input-container">
            <label for="viewCount" style="margin-bottom: 4px; font-size: 14px;">Estimated Monthly Views</label>
            <input type="number" class="url-input" id="viewCount" placeholder="Enter number of views per month" value="10000">
          </div>
          
          <div class="url-input-container">
            <label for="cpmRate" style="margin-bottom: 4px; font-size: 14px;">Estimated CPM ($)</label>
            <input type="number" step="0.01" class="url-input" id="cpmRate" placeholder="Enter CPM rate (average $2-$10)" value="4">
            <div style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;">
              CPM varies by country and niche. Average is $2-$10.
            </div>
          </div>
          
          <div class="url-input-container">
            <label for="engagementRate" style="margin-bottom: 4px; font-size: 14px;">Engagement Rate (%)</label>
            <input type="number" step="0.1" class="url-input" id="engagementRate" placeholder="Enter engagement rate %" value="5">
            <div style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;">
              Higher engagement can lead to higher revenue.
            </div>
          </div>
          
          <button class="material-btn w-100" id="calculateRevenueBtn">
            <i class="fas fa-calculator me-2"></i> Calculate Revenue
          </button>
        </div>
      </div>

      <div id="revenueResults" class="results-container" style="display: none;">
        <div class="results-header">
          <span>Estimated Revenue</span>
          <button class="copy-btn" id="exportRevenueBtn">
            <i class="fas fa-download"></i>
          </button>
        </div>
        <div class="results-content">
          <div class="revenue-result">
            <div class="revenue-amount" id="estimatedRevenue">$40.00</div>
            <div class="revenue-label">Monthly Revenue Estimate</div>
            <div class="revenue-range" id="revenueRange">Range: $32.00 - $48.00</div>
          </div>
          
          <div class="revenue-breakdown">
            <div class="revenue-breakdown-title">Revenue Breakdown</div>
            <div class="revenue-breakdown-item">
              <div class="revenue-breakdown-label">Monthly Views</div>
              <div class="revenue-breakdown-value" id="breakdownViews">10,000</div>
            </div>
            <div class="revenue-breakdown-item">
              <div class="revenue-breakdown-label">Ad Impressions (80% of views)</div>
              <div class="revenue-breakdown-value" id="adImpressions">8,000</div>
            </div>
            <div class="revenue-breakdown-item">
              <div class="revenue-breakdown-label">Estimated CPM</div>
              <div class="revenue-breakdown-value" id="breakdownCpm">$4.00</div>
            </div>
            <div class="revenue-breakdown-item">
              <div class="revenue-breakdown-label">Annual Revenue Projection</div>
              <div class="revenue-breakdown-value" id="annualRevenue">$480.00</div>
            </div>
          </div>
          
          <div class="revenue-breakdown">
            <div class="revenue-breakdown-title">Additional Income Potential</div>
            <div class="revenue-breakdown-item">
              <div class="revenue-breakdown-label">Channel Memberships</div>
              <div class="revenue-breakdown-value" id="membershipRevenue">$20.00</div>
            </div>
            <div class="revenue-breakdown-item">
              <div class="revenue-breakdown-label">Super Chat/Super Thanks</div>
              <div class="revenue-breakdown-value" id="superChatRevenue">$15.00</div>
            </div>
            <div class="revenue-breakdown-item">
              <div class="revenue-breakdown-label">Merchandise Shelf</div>
              <div class="revenue-breakdown-value" id="merchRevenue">$25.00</div>
            </div>
            <div class="revenue-breakdown-item">
              <div class="revenue-breakdown-label">Total Monthly Potential</div>
              <div class="revenue-breakdown-value" id="totalRevenue">$100.00</div>
            </div>
          </div>
          
          <div style="font-size: 12px; color: var(--text-secondary); margin-top: 16px; text-align: center;">
            Note: This is an estimate only. Actual revenue depends on many factors including audience location, video length, and advertiser demand.
          </div>
        </div>
      </div>
      
      <div class="admob-banner">
        <span>Advertisement</span>
      </div>
    </div>

    <!-- Watch Video Screen (NEW) -->
    <div id="watch-video-screen" class="tab-content">
      <div class="material-card">
        <div class="card-title">
          <div class="card-title-text">
            <i class="fas fa-play-circle"></i> Watch Videos
          </div>
          <div class="card-actions">
            <button class="copy-btn" id="refreshWatchPageBtn">
              <i class="fas fa-sync"></i>
            </button>
          </div>
        </div>
        <div class="card-content">
          <div class="search-container">
            <input type="text" class="search-input" id="watchVideoSearch" placeholder="Search videos or paste YouTube URL...">
            <button class="search-icon" id="watchSearchButton">
              <i class="fas fa-search"></i>
            </button>
          </div>
          <div id="watchVideoSearchResults" style="display: none;">
            <div class="card-content" id="watchSearchResultsContent">
              <!-- Search results will be loaded here -->
            </div>
            <button class="material-btn w-100" id="loadMoreWatchResultsBtn" style="margin-top: 16px; display: none;">
                <i class="fas fa-sync me-2"></i> Load More
            </button>
          </div>
        </div>
      </div>
      
      <!-- YouTube Video Player -->
      <div id="videoPlayerCard" class="material-card" style="display: none;">
        <div id="videoPlayerContainer" class="video-player-container">
          <iframe id="videoPlayer" class="video-player" src="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        </div>
        
        <div class="video-meta-container">
          <div class="video-meta-title" id="watchVideoTitle">Video Title</div>
          <div class="channel-row">
            <div class="channel-info">
              <img src="" id="watchChannelImg" class="video-thumbnail circle" alt="Channel">
              <div class="channel-name" id="watchChannelName">Channel Name</div>
            </div>
            <button class="subscribe-btn">Subscribe</button>
          </div>
          <div class="video-info-row">
            <span id="watchVideoViews">0 views</span>
            <span></span>
            <span id="watchVideoDate">Jan 1, 2024</span>
          </div>
        </div>
        
        <div class="video-actions">
          <button class="action-btn" id="likeBtn">
            <i class="fas fa-thumbs-up"></i>
            <span>Like</span>
          </button>
          <button class="action-btn" id="dislikeBtn">
            <i class="fas fa-thumbs-down"></i>
            <span>Dislike</span>
          </button>
          <button class="action-btn" id="shareBtn">
            <i class="fas fa-share"></i>
            <span>Share</span>
          </button>
          <button class="action-btn" id="downloadBtn">
            <i class="fas fa-download"></i>
            <span>Download</span>
          </button>
          <button class="action-btn" id="saveBtn">
            <i class="fas fa-bookmark"></i>
            <span>Save</span>
          </button>
        </div>
        
        <div class="description-container collapsed" id="watchVideoDescription">
          Video description will appear here...
        </div>
        <button class="show-more-btn" id="showMoreDescBtn">SHOW MORE</button>
        
        <div class="video-actions" style="border-top: 1px solid var(--divider-color); border-bottom: none;">
          <button class="material-btn" id="extractFromWatchBtn" style="flex: 1;">
            <i class="fas fa-search me-1"></i> Extract Video Metadata
          </button>
        </div>
      </div>
      
      <div class="admob-banner">
        <span>Advertisement</span>
      </div>
      
      <div class="material-card" id="relatedVideosCard" style="display: none;">
        <div class="card-title">
          <div class="card-title-text">
            <i class="fas fa-th-list"></i> Related Videos
          </div>
        </div>
        <div class="card-content" id="relatedVideosContainer">
          <!-- Related videos will be loaded here -->
        </div>
      </div>
    </div>

    <!-- Thumbnail Downloader Screen -->
    <div id="thumbnail-screen" class="tab-content">
      <div class="material-card">
        <div class="card-title">
          <div class="card-title-text">
            <i class="fas fa-image"></i> Thumbnail Downloader
          </div>
          <div class="card-actions">
            <button class="copy-btn" id="refreshThumbnailBtn">
              <i class="fas fa-sync"></i>
            </button>
          </div>
        </div>
        <div class="card-content">
          <div class="url-input-container">
            <input type="text" class="url-input" id="thumbnailUrl" placeholder="Paste YouTube URL" required>
            <button class="paste-btn" id="pasteThumbnailUrlBtn">
              <i class="fas fa-paste"></i> Paste
            </button>
          </div>
          
          <div class="tabs-container">
            <div class="tab active" data-quality="maxresdefault">HD (1280720)</div>
            <div class="tab" data-quality="sddefault">SD (640480)</div>
            <div class="tab" data-quality="hqdefault">HQ (480360)</div>
            <div class="tab" data-quality="mqdefault">MQ (320180)</div>
            <div class="tab" data-quality="default">Default (12090)</div>
          </div>
          
          <div id="thumbnailPreview" style="margin-bottom: 16px; display: none;">
            <img id="previewImage" src="" alt="Thumbnail Preview" style="width: 100%; border-radius: 4px;">
          </div>
          
          <button class="material-btn w-100" id="downloadThumbnailBtn">
            <i class="fas fa-download me-2"></i> Download Thumbnail
          </button>
        </div>
      </div>
      
      <div class="admob-rectangle">
        <span>Advertisement</span>
      </div>
    </div>

    <!-- Comments Screen -->
    <div id="comments-screen" class="tab-content">
      <div class="material-card">
        <div class="card-title">
          <div class="card-title-text">
            <i class="fas fa-comments"></i> Video Comments
          </div>
          <div class="card-actions">
            <button class="copy-btn" id="refreshCommentsPageBtn">
              <i class="fas fa-sync"></i>
            </button>
          </div>
        </div>
        <div class="card-content">
          <div class="url-input-container">
            <input type="text" class="url-input" id="commentsUrl" placeholder="Paste YouTube Video URL" required>
            <button class="paste-btn" id="pasteCommentsUrlBtn">
              <i class="fas fa-paste"></i> Paste
            </button>
          </div>
          <button class="material-btn w-100" id="getCommentsBtn">
            <i class="fas fa-search me-2"></i> Get Comments
          </button>
        </div>
      </div>

      <div class="progress-container" id="commentsProgress">
        <div class="progress-bar"></div>
      </div>

      <div id="commentsResults" class="results-container">
        <div class="results-header">
          <span>Video Comments</span>
          <div style="display: flex; gap: 8px;">
            <button class="copy-btn" id="filterCommentsBtn">
              <i class="fas fa-filter"></i>
            </button>
            <button class="copy-btn" onclick="exportComments()">
              <i class="fas fa-download"></i>
            </button>
            <button class="copy-btn" id="refreshCommentsBtn">
              <i class="fas fa-sync"></i>
            </button>
          </div>
        </div>
        <div class="results-content">
          <div class="search-container">
            <input type="text" class="search-input" id="commentsSearch" placeholder="Search in comments...">
            <i class="fas fa-search search-icon"></i>
          </div>
          
          <div id="commentsContainer">
            <!-- Comments will be loaded here -->
          </div>
          
          <button class="material-btn w-100" id="loadMoreCommentsBtn" style="margin-top: 16px;">
            <i class="fas fa-sync me-2"></i> Load More Comments
          </button>
        </div>
      </div>
      
      <div class="admob-banner">
        <span>Advertisement</span>
      </div>
    </div>

    <!-- Keyword Suggestions Screen -->
    <div id="keyword-screen" class="tab-content">
      <div class="material-card">
        <div class="card-title">
          <div class="card-title-text">
            <i class="fas fa-key"></i> Keyword Suggestions
          </div>
          <div class="card-actions">
            <button class="copy-btn" id="refreshKeywordsPageBtn">
              <i class="fas fa-sync"></i>
            </button>
          </div>
        </div>
        <div class="card-content">
          <div class="url-input-container">
            <input type="text" class="url-input" id="keywordInput" placeholder="Enter a keyword" required>
          </div>
          <button class="material-btn w-100" id="getKeywordsBtn">
            <i class="fas fa-search me-2"></i> Get Suggestions
          </button>
        </div>
      </div>

      <div class="progress-container" id="keywordProgress">
        <div class="progress-bar"></div>
      </div>

      <div id="keywordResults" class="results-container">
        <div class="results-header">
          <span>Keyword Suggestions</span>
          <div style="display: flex; gap: 8px;">
            <button class="copy-btn" onclick="exportKeywords()">
              <i class="fas fa-download"></i>
            </button>
            <button class="copy-btn" id="refreshKeywordsBtn">
              <i class="fas fa-sync"></i>
            </button>
          </div>
        </div>
        <div class="results-content">
          <div class="tags-container" id="keywordsContainer">
            <!-- Keywords will be loaded here -->
          </div>
          
          <div class="results-section">
            <div class="section-title">
              <span>All Keywords</span>
              <button class="copy-btn" onclick="copyToClipboard('keywordsList')">
                <i class="fas fa-copy"></i>
              </button>
            </div>
            <div class="section-content" id="keywordsList"></div>
          </div>
        </div>
      </div>
      
      <div class="admob-rectangle">
        <span>Advertisement</span>
      </div>
    </div>

    <!-- Consolidated AI Tools Screen -->
    <div id="ai-tools-screen" class="tab-content">
      <div class="material-card">
        <div class="card-title">
          <div class="card-title-text">
            <i class="fas fa-brain"></i> AI Content Tools
          </div>
          <div class="card-actions">
            <button class="copy-btn" id="refreshAIToolsBtn">
              <i class="fas fa-sync"></i>
            </button>
          </div>
        </div>
        <div class="card-content">
          <div class="tabs-container">
            <div class="tab active" data-ai-tool="description">AI Description</div>
            <div class="tab" data-ai-tool="title">AI Title</div>
          </div>

          <!-- AI Description Generator Content -->
          <div id="ai-description-tool-content" class="tab-content active">
            <div class="platform-selector">
              <div class="platform-item active" data-platform="youtube">
                <i class="fab fa-youtube"></i>
                <span>YouTube</span>
              </div>
              <div class="platform-item" data-platform="tiktok">
                <i class="fab fa-tiktok"></i>
                <span>TikTok</span>
              </div>
              <div class="platform-item" data-platform="instagram">
                <i class="fab fa-instagram"></i>
                <span>Instagram</span>
              </div>
            </div>

            <div class="url-input-container">
              <textarea class="url-input" id="descriptionTopic" placeholder="What's your video about? (E.g., 'How to make chocolate chip cookies', 'iPhone camera tips')" style="height: 80px;"></textarea>
            </div>

            <div class="url-input-container">
              <textarea class="url-input" id="descriptionDetails" placeholder="Additional details (optional - e.g., key points, specific features, target audience)" style="height: 80px;"></textarea>
            </div>

            <button class="material-btn w-100" id="generateDescriptionBtn">
              <i class="fas fa-magic me-2"></i> Generate Descriptions
            </button>
          </div>

          <!-- AI Title Generator Content -->
          <div id="ai-title-tool-content" class="tab-content">
            <div class="platform-selector">
              <div class="platform-item active" data-platform="youtube">
                <i class="fab fa-youtube"></i>
                <span>YouTube</span>
              </div>
              <div class="platform-item" data-platform="tiktok">
                <i class="fab fa-tiktok"></i>
                <span>TikTok</span>
              </div>
              <div class="platform-item" data-platform="instagram">
                <i class="fab fa-instagram"></i>
                <span>Instagram</span>
              </div>
            </div>

            <div class="url-input-container">
              <textarea class="url-input" id="titleTopic" placeholder="What's your video about? (E.g., 'Makeup tutorial for beginners', 'Gaming setup tour')" style="height: 80px;"></textarea>
            </div>

            <button class="material-btn w-100" id="generateTitleBtn">
              <i class="fas fa-magic me-2"></i> Generate Titles
            </button>
          </div>
        </div>
      </div>

      <div class="progress-container" id="aiToolProgress">
        <div class="progress-bar"></div>
      </div>

      <div id="aiToolResults" class="results-container">
        <div class="results-header">
          <span id="aiToolResultsTitle">AI Generated Content</span>
          <button class="copy-btn" id="regenerateAIToolBtn">
            <i class="fas fa-sync"></i>
          </button>
        </div>
        <div class="results-content">
          <div id="aiToolOutputs">
            <!-- Generated content will appear here -->
          </div>
        </div>
      </div>
      
      <div class="admob-rectangle">
        <span>Advertisement</span>
      </div>
    </div>

    <!-- Transcript Generator Screen -->
    <div id="transcript-screen" class="tab-content">
      <div class="material-card">
        <div class="card-title">
          <div class="card-title-text">
            <i class="fas fa-closed-captioning"></i> YouTube Transcript Generator
          </div>
          <div class="card-actions">
            <button class="copy-btn" id="refreshTranscriptPageBtn">
              <i class="fas fa-sync"></i>
            </button>
          </div>
        </div>
        <div class="card-content">
          <div class="url-input-container">
            <input type="text" class="url-input" id="transcriptUrl" placeholder="Paste YouTube Video URL" required>
            <button class="paste-btn" id="pasteTranscriptUrlBtn">
              <i class="fas fa-paste"></i> Paste
            </button>
          </div>
          <button class="material-btn w-100" id="getTranscriptBtn">
            <i class="fas fa-search me-2"></i> Get Transcript
          </button>
        </div>
      </div>

      <div class="progress-container" id="transcriptProgress">
        <div class="progress-bar"></div>
      </div>

      <div id="transcriptResults" class="results-container">
        <div class="results-header">
          <span>Video Transcript</span>
          <div style="display: flex; gap: 8px;">
            <button class="copy-btn" onclick="copyToClipboard('transcriptContent')">
              <i class="fas fa-copy"></i>
            </button>
            <button class="copy-btn" onclick="exportTranscript()">
              <i class="fas fa-download"></i>
            </button>
            <button class="copy-btn" id="refreshTranscriptBtn">
              <i class="fas fa-sync"></i>
            </button>
          </div>
        </div>
        <div class="results-content">
          <div class="tabs-container">
            <div class="tab active" data-transcript-format="text">Text Only</div>
            <div class="tab" data-transcript-format="timestamps">With Timestamps</div>
          </div>
          
          <div class="transcript-container" id="transcriptContent">
            <!-- Transcript will be loaded here -->
          </div>
        </div>
      </div>
      
      <div class="admob-banner">
        <span>Advertisement</span>
      </div>
    </div>

    <!-- Content Planner Screen -->
    <div id="content-planner-screen" class="tab-content">
      <div class="material-card">
        <div class="card-title">
          <div class="card-title-text">
            <i class="fas fa-calendar-alt"></i> Content Planner
          </div>
          <div class="card-actions">
            <button class="copy-btn" id="refreshPlannerBtn">
              <i class="fas fa-sync"></i>
            </button>
          </div>
        </div>
        <div class="card-content">
          <div class="calendar-month" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
            <button class="material-btn-text" id="prevMonthBtn">
              <i class="fas fa-chevron-left"></i>
            </button>
            <h3 id="currentMonth" style="margin: 0; font-size: 18px; font-weight: 500;">June 2024</h3>
            <button class="material-btn-text" id="nextMonthBtn">
              <i class="fas fa-chevron-right"></i>
            </button>
          </div>

          <div class="calendar-grid" id="calendarGrid">
            <!-- Calendar will be generated here -->
          </div>
          
          <button class="material-btn w-100" id="addContentBtn">
            <i class="fas fa-plus me-2"></i> Add New Content
          </button>
        </div>
      </div>

      <div id="plannerContent" class="content-planner-container">
        <!-- Planned content will be shown here -->
      </div>
      
      <div class="admob-rectangle">
        <span>Advertisement</span>
      </div>
    </div>

    <!-- Video Analytics Screen (New) -->
    <div id="analytics-screen" class="tab-content">
      <div class="material-card">
        <div class="card-title">
          <div class="card-title-text">
            <i class="fas fa-chart-bar"></i> Video Analytics
          </div>
          <div class="card-actions">
            <button class="copy-btn" id="refreshAnalyticsBtn">
              <i class="fas fa-sync"></i>
            </button>
          </div>
        </div>
        <div class="card-content">
          <div class="url-input-container">
            <input type="text" class="url-input" id="analyticsUrl" placeholder="Paste YouTube Video URL" required>
            <button class="paste-btn" id="pasteAnalyticsUrlBtn">
              <i class="fas fa-paste"></i> Paste
            </button>
          </div>
          <button class="material-btn w-100" id="getAnalyticsBtn">
            <i class="fas fa-search me-2"></i> Get Analytics
          </button>
        </div>
      </div>

      <div class="progress-container" id="analyticsProgress">
        <div class="progress-bar"></div>
      </div>

      <div id="analyticsResults" class="results-container">
        <div class="results-header">
          <span>Video Analytics</span>
          <button class="copy-btn" id="exportAnalyticsBtn">
            <i class="fas fa-download"></i>
          </button>
        </div>
        <div class="results-content">
          <div class="results-stats">
            <div class="stat-item">
              <div class="stat-value" id="analyticsViews">0</div>
              <div class="stat-label">Views</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" id="analyticsLikes">0</div>
              <div class="stat-label">Likes</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" id="analyticsComments">0</div>
              <div class="stat-label">Comments</div>
            </div>
          </div>
          
          <div class="results-section">
            <div class="section-title">Engagement Rate</div>
            <div style="height: 200px; background-color: var(--background-color); border-radius: 4px; display: flex; align-items: center; justify-content: center;">
              <div style="text-align: center;">
                <div style="font-size: 36px; font-weight: 500; color: var(--primary-color);" id="engagementRate">0%</div>
                <div style="color: var(--text-secondary);">Engagement Rate</div>
              </div>
            </div>
          </div>
          
          <div class="results-section">
            <div class="section-title">Audience Retention</div>
            <div style="height: 200px; background-color: var(--background-color); border-radius: 4px; padding: 16px;">
              <div style="height: 100%; display: flex; align-items: flex-end; gap: 8px;">
                <div id="retentionGraph" style="display: flex; align-items: flex-end; gap: 8px; height: 100%; width: 100%;">
                  <!-- Retention graph bars will be generated here -->
                </div>
              </div>
            </div>
          </div>
          
          <div class="results-section">
            <div class="section-title">Traffic Sources</div>
            <div style="background-color: var(--background-color); border-radius: 4px; padding: 16px;">
              <div id="trafficSources">
                <!-- Traffic sources will be generated here -->
              </div>
            </div>
          </div>
          
          <div class="results-section">
            <div class="section-title">Demographics</div>
            <div style="background-color: var(--background-color); border-radius: 4px; padding: 16px;">
              <div id="demographics">
                <!-- Demographics will be generated here -->
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="admob-banner">
        <span>Advertisement</span>
      </div>
    </div>

    <!-- Tag Generator Screen (New) -->
    <div id="tag-generator-screen" class="tab-content">
      <div class="material-card">
        <div class="card-title">
          <div class="card-title-text">
            <i class="fas fa-tags"></i> YouTube Tag Generator
          </div>
          <div class="card-actions">
            <button class="copy-btn" id="refreshTagGenBtn">
              <i class="fas fa-sync"></i>
            </button>
          </div>
        </div>
        <div class="card-content">
          <div class="url-input-container">
            <textarea class="url-input" id="tagTopic" placeholder="What's your video about? (E.g., 'iPhone camera tips', 'Best gaming laptops 2024')" style="height: 80px;"></textarea>
          </div>
          
          <div class="url-input-container">
            <input type="number" class="url-input" id="tagCount" placeholder="Number of tags (5-30)" value="20" min="5" max="30">
          </div>
          
          <button class="material-btn w-100" id="generateTagsBtn">
            <i class="fas fa-magic me-2"></i> Generate Tags
          </button>
        </div>
      </div>

      <div class="progress-container" id="tagGenProgress">
        <div class="progress-bar"></div>
      </div>

      <div id="tagGenResults" class="results-container">
        <div class="results-header">
          <span>Generated Tags</span>
          <div style="display: flex; gap: 8px;">
            <button class="copy-btn" onclick="copyToClipboard('generatedTagsList')">
              <i class="fas fa-copy"></i>
            </button>
            <button class="copy-btn" onclick="exportGeneratedTags()">
              <i class="fas fa-download"></i>
            </button>
            <button class="copy-btn" id="regenerateTagsBtn">
              <i class="fas fa-sync"></i>
            </button>
          </div>
        </div>
        <div class="results-content">
          <div class="tags-container" id="generatedTagsContainer">
            <!-- Generated tags will be loaded here -->
          </div>
          
          <div class="results-section">
            <div class="section-title">
              <span>All Tags</span>
              <button class="copy-btn" onclick="copyToClipboard('generatedTagsList')">
                <i class="fas fa-copy"></i>
              </button>
            </div>
            <div class="section-content" id="generatedTagsList"></div>
          </div>
        </div>
      </div>
      
      <div class="admob-rectangle">
        <span>Advertisement</span>
      </div>
    </div>

    <!-- Video Ideas Generator Screen (New) -->
    <div id="idea-generator-screen" class="tab-content">
      <div class="material-card">
        <div class="card-title">
          <div class="card-title-text">
            <i class="fas fa-lightbulb"></i> Video Ideas Generator
          </div>
          <div class="card-actions">
            <button class="copy-btn" id="refreshIdeasBtn">
              <i class="fas fa-sync"></i>
            </button>
          </div>
        </div>
        <div class="card-content">
          <div class="url-input-container">
            <input type="text" class="url-input" id="ideaNiche" placeholder="Enter your niche/topic (e.g., 'Gaming', 'Cooking', 'Tech Reviews')" required>
          </div>
          
          <div class="url-input-container">
            <select class="url-input" id="ideaCount">
              <option value="5">5 Ideas</option>
              <option value="10" selected>10 Ideas</option>
              <option value="15">15 Ideas</option>
              <option value="20">20 Ideas</option>
            </select>
          </div>
          
          <button class="material-btn w-100" id="generateIdeasBtn">
            <i class="fas fa-magic me-2"></i> Generate Video Ideas
          </button>
        </div>
      </div>

      <div class="progress-container" id="ideasProgress">
        <div class="progress-bar"></div>
      </div>

      <div id="ideasResults" class="results-container">
        <div class="results-header">
          <span>Video Ideas</span>
          <div style="display: flex; gap: 8px;">
            <button class="copy-btn" onclick="exportIdeas()">
              <i class="fas fa-download"></i>
            </button>
            <button class="copy-btn" id="regenerateIdeasBtn">
              <i class="fas fa-sync"></i>
            </button>
          </div>
        </div>
        <div class="results-content">
          <div id="ideasContainer">
            <!-- Generated video ideas will be loaded here -->
          </div>
        </div>
      </div>
      
      <div class="admob-banner">
        <span>Advertisement</span>
      </div>
    </div>

    <!-- Settings Screen -->
    <div id="settings-screen" class="tab-content">
      <div class="material-card">
        <div class="card-title">
          <div class="card-title-text">
            <i class="fas fa-cog"></i> Settings
          </div>
        </div>
        <div class="card-content">
          <div class="settings-item">
            <div>
              <div class="settings-label">Dark Mode</div>
              <div class="settings-description">Enable dark theme for the app</div>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="darkModeToggle">
              <span class="toggle-slider"></span>
            </label>
          </div>
          
          <div class="settings-item">
            <div>
              <div class="settings-label">High Quality Thumbnails</div>
              <div class="settings-description">Always use HD quality thumbnails</div>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="hqThumbnailToggle" checked>
              <span class="toggle-slider"></span>
            </label>
          </div>
          
          <div class="settings-item">
            <div>
              <div class="settings-label">Auto Save History</div>
              <div class="settings-description">Save watch history automatically</div>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="saveHistoryToggle" checked>
              <span class="toggle-slider"></span>
            </label>
          </div>
          
          <div class="settings-item">
            <div>
              <div class="settings-label">Autoplay Videos</div>
              <div class="settings-description">Play videos automatically when loaded</div>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="autoplayToggle" checked>
              <span class="toggle-slider"></span>
            </label>
          </div>
          
          <div class="settings-item">
            <div>
              <div class="settings-label">Clear Data</div>
              <div class="settings-description">Delete all saved data</div>
            </div>
            <button class="material-btn-text" id="clearDataBtn">Clear</button>
          </div>
        </div>
      </div>

      <!-- Developer Information Card -->
      <div class="developer-info">
        <div class="developer-header">
          <div class="developer-avatar">
            <i class="fas fa-user"></i>
          </div>
          <div>
            <div class="developer-name">Mohammed Sharif</div>
            <div class="developer-title">Game & Website Developer</div>
          </div>
        </div>
        
        <div class="contact-info">
          <div class="contact-item">
            <i class="fab fa-whatsapp"></i>
            <span>0306-3937090</span>
          </div>
          <div class="contact-item">
            <i class="fas fa-envelope"></i>
            <span>ms2600971@gmail.com</span>
          </div>
          <div class="contact-item">
            <i class="fas fa-globe"></i>
            <a href="https://www.crekode.com/developersharif" target="_blank">www.crekode.com/developersharif</a>
          </div>
        </div>
        
        <div style="margin-top: 16px;">
          <button class="material-btn w-100" id="contactDeveloperBtn">
            <i class="fas fa-envelope me-2"></i> Contact for Custom Projects
          </button>
        </div>
      </div>

      <div class="material-card">
        <div class="card-title">
          <div class="card-title-text">
            <i class="fas fa-info-circle"></i> About
          </div>
        </div>
        <div class="card-content">
          <p>YTAnalyzr - YouTube Analytics & Tools</p>
          <p>Version 5.0</p>
          <p style="margin-top: 8px;">Extract tags from videos, generate AI content, get video transcripts, and grow your YouTube channel.</p>
          <p style="margin-top: 16px; font-size: 12px;"> 2024 YTAnalyzr</p>
        </div>
      </div>
      
      <div class="admob-banner">
        <span>Advertisement</span>
      </div>
    </div>
  </div>

  <!-- Android Bottom Navigation -->
  <div class="bottom-nav">
    <a class="nav-item active" data-screen="home-screen">
      <i class="fas fa-home"></i>
      <span>Home</span>
    </a>
    <a class="nav-item" data-screen="watch-video-screen">
      <i class="fas fa-play-circle"></i>
      <span>Watch</span>
    </a>
    <a class="nav-item" data-screen="shorts-screen">
      <i class="fas fa-bolt"></i>
      <span>Shorts</span>
    </a>
    <a class="nav-item" data-screen="ai-tools-screen">
      <i class="fas fa-brain"></i>
      <span>AI Tools</span>
    </a>
    <a class="nav-item" data-screen="settings-screen">
      <i class="fas fa-cog"></i>
      <span>Settings</span>
    </a>
  </div>

  <!-- Toast Notification -->
  <div class="toast" id="toast"></div>

  <!-- Modals -->
  <div class="modal-backdrop" id="modalBackdrop"></div>

  <!-- Filter Comments Modal -->
  <div class="modal-container" id="filterModal">
    <div class="modal-header">
      <div class="modal-title">Filter Comments</div>
      <button class="modal-close" id="closeFilterModal">&times;</button>
    </div>
    <div class="modal-body">
      <div class="settings-item">
        <div class="settings-label">Show Replies</div>
        <label class="toggle-switch">
          <input type="checkbox" id="showRepliesToggle" checked>
          <span class="toggle-slider"></span>
        </label>
      </div>
      <div class="settings-item">
        <div class="settings-label">Sort By</div>
        <select class="url-input" id="commentSort">
          <option value="relevance">Relevance</option>
          <option value="time">Newest First</option>
          <option value="likeCount">Most Likes</option>
        </select>
      </div>
      <div class="settings-item">
        <div class="settings-label">Minimum Likes</div>
        <input type="number" class="url-input" id="minLikes" value="0" min="0" style="width: 80px;">
      </div>
      <div class="settings-item">
        <div class="settings-label">Has Question</div>
        <label class="toggle-switch">
          <input type="checkbox" id="hasQuestionToggle">
          <span class="toggle-slider"></span>
        </label>
      </div>
    </div>
    <div class="modal-footer">
      <button class="material-btn-outlined" id="resetFilterBtn">Reset</button>
      <button class="material-btn" id="applyFilterBtn">Apply</button>
    </div>
  </div>

  <!-- Add Content Modal -->
  <div class="modal-container" id="addContentModal">
    <div class="modal-header">
      <div class="modal-title">Add New Content</div>
      <button class="modal-close" id="closeAddContentModal">&times;</button>
    </div>
    <div class="modal-body">
      <div class="url-input-container">
        <label for="contentTitle" style="margin-bottom: 4px; font-size: 14px;">Video Title</label>
        <input type="text" class="url-input" id="contentTitle" placeholder="Enter your video title">
      </div>
      
      <div class="url-input-container">
        <label for="contentDate" style="margin-bottom: 4px; font-size: 14px;">Publish Date</label>
        <input type="date" class="url-input" id="contentDate">
      </div>
      
      <div class="url-input-container">
        <label for="contentDescription" style="margin-bottom: 4px; font-size: 14px;">Description</label>
        <textarea class="url-input" id="contentDescription" placeholder="Enter video description" style="height: 80px;"></textarea>
      </div>
      
      <div class="url-input-container">
        <label for="contentTags" style="margin-bottom: 4px; font-size: 14px;">Tags (comma separated)</label>
        <input type="text" class="url-input" id="contentTags" placeholder="tag1, tag2, tag3">
      </div>
      
      <div class="url-input-container">
        <label for="contentStatus" style="margin-bottom: 4px; font-size: 14px;">Status</label>
        <select class="url-input" id="contentStatus">
          <option value="planned">Planned</option>
          <option value="ready">Ready to Publish</option>
          <option value="published">Published</option>
        </select>
      </div>
    </div>
    <div class="modal-footer">
      <button class="material-btn-outlined" id="cancelAddContentBtn">Cancel</button>
      <button class="material-btn" id="saveContentBtn">Save</button>
    </div>
  </div>

  <script>
    // YouTube Data API Key
    const API_KEY = "AIzaSyCmnNbFK889CClqOpnRw_-w8n1GkS2KJxE";
    
    // Store all user data
    const userData = {
      videoHistory: [],
      settings: {
        darkMode: false,
        hqThumbnail: true,
        saveHistory: true,
        autoplay: true
      }
    };
    
    // Current metadata
    let currentMetadata = null;
    let currentComments = [];
    let currentKeywords = [];
    let watchVideoSearchResults = []; // New variable for watch video screen search
    let contentPlanItems = [];
    let currentMonth = new Date();
    let isVideoFullscreen = false; // Re-introduced for potential future video player enhancements

    // Keep track of the current video playing on the watch screen
    let currentWatchVideoId = null; 
    let watchSearchResultsNextPageToken = null; // For loading more search results on watch page

    // AI Title/Description Templates
    const titleTemplates = {
      youtube: [
        " {topic} | {detail} Tutorial 2024",
        "How I {topic} in Just 10 Minutes!  {detail}",
        "{number} {topic} Tricks You NEED To Know!  {detail}",
        "The TRUTH About {topic}  {detail} Revealed!",
        "I Tried {topic} For 30 Days... This Happened!  {detail}",
        "{topic} Challenge: {detail} Edition ",
        "Ultimate Guide to {topic}: {detail} for Beginners ",
        "{topic} Masterclass: Transform Your {detail} Today! ",
        "Pro {topic} Tips That Nobody Tells You About!  {detail}",
        "We Need To Talk About {topic}... {detail} Changed Everything!"
      ],
      tiktok: [
        "This {topic} hack will blow your mind!  #fyp",
        "POV: When you try {topic} for the first time #viral",
        "They didn't believe I could {topic} until...  #trending",
        "Day {number}: {topic} challenge!  #foryou",
        "I tried the viral {topic} trend... #tiktokmadememadeit",
        "3 {topic} secrets the pros don't share!  #learnontiktok",
        "Wait for it... {topic} edition!  #comedy",
        "Tell me you {topic} without telling me you {topic} ",
        "POV: {topic} gone wrong  #fails",
        "{topic} life hack that actually works!  #tutorial"
      ],
      instagram: [
        " Elevating my {topic} game | {detail} vibes only ",
        "Today's {topic} moment  | {detail} #instagood",
        "{topic} diaries  | When {detail} just hits different ",
        "That {topic} feeling  | {detail} #instamood",
        "Exploring {topic} adventures  | {detail} #photooftheday",
        "I need to talk about {topic}... {detail} changed everything!",
        "{topic} appreciation post  | {detail} has my heart",
        "New {topic} journey begins  | {detail} chapter",
        "{topic} essentials  | My go-to {detail} routine",
        "Finding joy in {topic}  | {detail} moments #blessed",
        "{topic} collection growing  | Adding {detail} to the mix"
      ]
    };
    
    const descriptionTemplates = {
      youtube: [
        " WATCH NOW: The most comprehensive guide to {topic} you'll ever need!\n\nIn this video, I break down everything about {detail} and share my personal tips that transformed my results. If you've been struggling with {topic}, this is the solution you've been waiting for.\n\n TIMESTAMPS:\n00:00 Introduction\n01:23 Understanding {topic}\n04:56 Step-by-step tutorial\n10:25 Advanced techniques\n\n If this helped you, please LIKE and SUBSCRIBE for more content like this!\n\n#Tutorial #{topic} #{detail} #HowTo",
        
        "Ever wondered how to master {topic}? \n\nThis video reveals the secrets behind {detail} that nobody talks about! After years of experience, I'm sharing the shortcuts that will save you time and frustration.\n\n WHAT YOU'LL LEARN:\n- Quick {topic} hacks\n- Common mistakes to avoid\n- Professional techniques for {detail}\n\n FOLLOW ME for daily tips:\nInstagram: @username\nTwitter: @username\n\nDon't forget to SUBSCRIBE and hit the NOTIFICATION BELL! \n\n#YourChannel #{topic} #{detail}",
        
        " REVEALED: The ultimate {topic} guide that changed everything for me!\n\nAfter struggling with {detail} for years, I finally discovered these game-changing techniques. This video packs everything I wish I knew when I started.\n\n THE COMPLETE BREAKDOWN:\n- Beginner-friendly approach\n- Advanced strategies for {topic}\n- Real results with {detail}\n\n COMMENT below: What's your biggest challenge with {topic}?\n\nLike, Subscribe & Share if this helped you! \n\n#Tutorial #{topic} #Tips"
      ],
      tiktok: [
        "How I mastered {topic} in just one week \n{detail} was the game-changer!\nTry this and thank me later \n#fyp #{topic} #{detail} #viral #learnontiktok",
        
        "POV: When your {topic} skills finally click \n{detail} technique that changed everything!\nWho else needs to try this?? \n#{topic} #tiktoktrend #{detail} #foryoupage",
        
        "The {topic} hack nobody talks about \nThis {detail} trick is pure magic\nSaving you hours of frustration!\n#tiktoktips #{topic} #{detail} #lifehack"
      ],
      instagram: [
        " Embracing the beauty of {topic} today!\n\nFound myself lost in the process of {detail} and couldn't be happier with the results. Sometimes the journey is even more rewarding than the destination.\n\nWhat's your favorite thing about {topic}? Share below! \n\n.\n.\n.\n#{topic} #{detail} #instagood #photooftheday #instadaily",
        
        "Today's {topic} adventures led me to discover the magic of {detail} \n\nThere's something so satisfying about finding new ways to enhance your experience with the things you love. This particular approach to {topic} has completely transformed my perspective.\n\nDouble tap if you're also passionate about {topic}! \n\n#{topic}lover #{detail}vibes #instamood #explorepage",
        
        "Sharing my {topic} journey with you all today \n\nAfter experimenting with different {detail} techniques, I've finally found what works for me. It's amazing how small changes can make such a big difference!\n\nSaving this to my highlights for future reference \n\n#{topic} #{detail}tips #instagramhub #shareyourjourney"
      ]
    };
    
    // Image list for dynamic panels (from images.html)
    const imageList = [
      "https://i.ibb.co/Mk7p3GSs/Untitled-design-20250514-153329-0000.png",
      "https://i.ibb.co/7Nv7n83N/Untitled-design-20250515-213921-0000.png",
      "https://i.ibb.co/KxC8P86M/Purple-Pink-Gradient-Mobile-Application-Presentation-20250516-021125-0000.png",
      "https://i.ibb.co/PZsGLpnv/FB-IMG-1748509091308.jpg",
      "https://i.ibb.co/yFCHsnyh/Purple-Modern-Mobile-Apps-Services-Presentation-20250513-004131-0000.png",
    ];

    // Initialize the app
    document.addEventListener('DOMContentLoaded', () => {
      // Load saved settings
      loadUserData();
      
      // Apply settings
      if (userData.settings.darkMode || (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        enableDarkMode();
      }
      
      document.getElementById('hqThumbnailToggle').checked = userData.settings.hqThumbnail;
      document.getElementById('saveHistoryToggle').checked = userData.settings.saveHistory;
      document.getElementById('autoplayToggle').checked = userData.settings.autoplay;

      // Setup event listeners
      setupEventListeners();
      
      // Initialize calendar
      generateCalendar();
      
      // Initialize content planner with sample data
      initializeContentPlanner();
      
      // Update history display
      updateHistoryDisplay();
      
      // Initialize analytics screen event listeners
      setupAnalyticsScreenEvents();
      
      // Initialize tag generator screen event listeners
      setupTagGeneratorEvents();
      
      // Initialize idea generator screen event listeners
      setupIdeaGeneratorEvents();
      
      // Initialize revenue calculator screen event listeners
      setupRevenueCalculatorEvents();
      
      // Initialize shorts creator screen event listeners
      setupShortsCreatorEvents();

      // Initialize image sliders
      initializeImageSlider('mainImageSlider', 'mainSlideImage');
      initializeImageSlider('shortsImageSlider', 'shortsSlideImage');
    });

    // Function to initialize an image slider
    function initializeImageSlider(containerId, imgId) {
      const container = document.getElementById(containerId);
      if (!container) return; // Exit if container doesn't exist (e.g., if it was replaced by ad)

      const imgElement = document.getElementById(imgId);
      if (!imgElement) return;

      let current = 0;
      imgElement.src = imageList[current];
      imgElement.classList.add('active');

      setInterval(() => {
        imgElement.classList.remove('active');
        setTimeout(() => {
          current = (current + 1) % imageList.length;
          imgElement.src = imageList[current];
          imgElement.classList.add('active');
        }, 200); // Short delay for fade effect
      }, 3000);
    }
    
    // Load user data from local storage
    function loadUserData() {
      try {
        const savedData = localStorage.getItem('ytAnalyzrUserData');
        if (savedData) {
          const parsedData = JSON.parse(savedData);
          
          // Merge with defaults for backward compatibility
          userData.videoHistory = parsedData.videoHistory || [];
          userData.settings = {
            ...userData.settings,
            ...parsedData.settings
          };
        }
      } catch (e) {
        console.log('Could not load user data:', e);
      }
    }
    
    // Save user data to local storage
    function saveUserData() {
      try {
        localStorage.setItem('ytAnalyzrUserData', JSON.stringify(userData));
      } catch (e) {
        console.log('Could not save user data:', e);
      }
    }

    // Setup revenue calculator events
    function setupRevenueCalculatorEvents() {
      // Calculate revenue button
      document.getElementById('calculateRevenueBtn')?.addEventListener('click', () => {
        calculateRevenue();
      });
      
      // Export revenue button
      document.getElementById('exportRevenueBtn')?.addEventListener('click', () => {
        exportRevenueData();
      });
      
      // Refresh revenue button
      document.getElementById('refreshRevenueBtn')?.addEventListener('click', () => {
        document.getElementById('viewCount').value = '10000';
        document.getElementById('cpmRate').value = '4';
        document.getElementById('engagementRate').value = '5';
        document.getElementById('revenueResults').style.display = 'none';
      });
    }
    
    // Calculate revenue
    function calculateRevenue() {
      const viewCount = parseInt(document.getElementById('viewCount').value) || 10000;
      const cpmRate = parseFloat(document.getElementById('cpmRate').value) || 4;
      const engagementRate = parseFloat(document.getElementById('engagementRate').value) || 5;
      
      // Calculate ad impressions (approx 80% of views)
      const adImpressions = Math.floor(viewCount * 0.8);
      
      // Calculate basic ad revenue
      const revenue = (adImpressions / 1000) * cpmRate;
      
      // Adjust based on engagement rate (higher engagement = higher revenue)
      const engagementMultiplier = 1 + (engagementRate - 5) / 100;
      const adjustedRevenue = revenue * engagementMultiplier;
      
      // Calculate revenue range (20%)
      const minRevenue = adjustedRevenue * 0.8;
      const maxRevenue = adjustedRevenue * 1.2;
      
      // Calculate additional income potential
      const membershipRevenue = (viewCount / 1000) * 0.5 * engagementRate / 10;
      const superChatRevenue = (viewCount / 1000) * 0.3 * engagementRate / 10;
      const merchRevenue = (viewCount / 1000) * 0.6 * engagementRate / 10;
      const totalPotential = adjustedRevenue + membershipRevenue + superChatRevenue + merchRevenue;
      
      // Update UI
      document.getElementById('estimatedRevenue').textContent = `$${adjustedRevenue.toFixed(2)}`;
      document.getElementById('revenueRange').textContent = `Range: $${minRevenue.toFixed(2)} - $${maxRevenue.toFixed(2)}`;
      document.getElementById('breakdownViews').textContent = formatNumber(viewCount);
      document.getElementById('adImpressions').textContent = formatNumber(adImpressions);
      document.getElementById('breakdownCpm').textContent = `$${cpmRate.toFixed(2)}`;
      document.getElementById('annualRevenue').textContent = `$${(adjustedRevenue * 12).toFixed(2)}`;
      document.getElementById('membershipRevenue').textContent = `$${membershipRevenue.toFixed(2)}`;
      document.getElementById('superChatRevenue').textContent = `$${superChatRevenue.toFixed(2)}`;
      document.getElementById('merchRevenue').textContent = `$${merchRevenue.toFixed(2)}`;
      document.getElementById('totalRevenue').textContent = `$${totalPotential.toFixed(2)}`;
      
      // Show results
      document.getElementById('revenueResults').style.display = 'block';
    }
    
    // Export revenue data
    function exportRevenueData() {
      const viewCount = parseInt(document.getElementById('viewCount').value) || 10000;
      const cpmRate = parseFloat(document.getElementById('cpmRate').value) || 4;
      const engagementRate = parseFloat(document.getElementById('engagementRate').value) || 5;
      const estimatedRevenue = document.getElementById('estimatedRevenue').textContent;
      const revenueRange = document.getElementById('revenueRange').textContent;
      const annualRevenue = document.getElementById('annualRevenue').textContent;
      const totalPotential = document.getElementById('totalRevenue').textContent;
      
      const revenueData = {
        inputs: {
          monthlyViews: viewCount,
          cpmRate: cpmRate,
          engagementRate: engagementRate + '%'
        },
        estimates: {
          monthlyRevenue: estimatedRevenue,
          revenueRange: revenueRange.replace('Range: ', ''),
          annualRevenue: annualRevenue,
          totalPotential: totalPotential
        },
        generatedAt: new Date().toISOString()
      };
      
      const jsonString = JSON.stringify(revenueData, null, 2);
      const blob = new Blob([jsonString], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      
      const a = document.createElement('a');
      a.href = url;
      a.download = 'revenue_estimate.json';
      a.click();
      
      showToast('Revenue data exported');
    }
    
    // Setup shorts creator events
    function setupShortsCreatorEvents() {
      // Generate shorts button
      document.getElementById('generateShortsBtn')?.addEventListener('click', () => {
        generateShortsIdeas();
      });
      
      // Regenerate shorts button
      document.getElementById('regenerateShortsBtn')?.addEventListener('click', () => {
        generateShortsIdeas();
      });
      
      // Refresh shorts button
      document.getElementById('refreshShortsBtn')?.addEventListener('click', () => {
        document.getElementById('shortsNiche').value = '';
        document.getElementById('shortsResults').style.display = 'none';
      });
    }
    
    // Generate shorts ideas
    function generateShortsIdeas() {
      const niche = document.getElementById('shortsNiche').value.trim();
      const count = parseInt(document.getElementById('shortsCount').value) || 5;
      
      if (!niche) {
        showToast('Please enter a niche');
        return;
      }
      
      // Show loading
      document.getElementById('shortsProgress').style.display = 'block';
      document.getElementById('shortsResults').style.display = 'none';
      
      // Simulate API response
      setTimeout(() => {
        // Hide loading
        document.getElementById('shortsProgress').style.display = 'none';
        
        // Generate ideas
        const ideas = generateShortsIdeasForNiche(niche, count);
        
        // Update UI
        const shortsContainer = document.getElementById('shortsContainer');
        shortsContainer.innerHTML = '';
        
        ideas.forEach((idea, index) => {
          const shortsIdea = document.createElement('div');
          shortsIdea.className = 'shorts-idea-container';
          
          // Create tags HTML
          const tagsHtml = idea.tags.map(tag => `<div class="shorts-idea-tag">${tag}</div>`).join('');
          
          shortsIdea.innerHTML = `
            <div class="shorts-idea-header">
              <div class="shorts-idea-icon">
                <i class="fas fa-bolt"></i>
              </div>
              <div class="shorts-idea-title">${idea.title}</div>
            </div>
            <div class="shorts-idea-content">${idea.description}</div>
            <div class="shorts-idea-tags">${tagsHtml}</div>
            <div class="shorts-actions">
              <button class="material-btn-outlined" onclick="copyShortsIdea(this)">
                <i class="fas fa-copy me-1"></i> Copy
              </button>
              <button class="material-btn" onclick="addShortsToPlanner('${idea.title.replace(/'/g, "\\'")}')">
                <i class="fas fa-calendar-plus me-1"></i> Add to Planner
              </button>
            </div>
          `;
          
          shortsContainer.appendChild(shortsIdea);
        });
        
        // Show results
        document.getElementById('shortsResults').style.display = 'block';
      }, 1500);
    }
    
    // Generate shorts ideas for niche
    function generateShortsIdeasForNiche(niche, count) {
      const ideas = [
        {
          title: `${niche} Hack Nobody Is Talking About`,
          description: `Quick 30-second tutorial revealing a little-known technique for ${niche} that most people don't know about. Film in vertical format with fast-paced editing and on-screen text highlighting key points.`,
          tags: [`${niche}`, 'shorts', 'hack', 'tutorial']
        },
        {
          title: `3 ${niche} Mistakes You're Making`,
          description: `Short video identifying common mistakes people make with ${niche} and quick solutions for each. Use clear before/after examples and fast transitions between points.`,
          tags: [`${niche}`, 'mistakes', 'tips', 'tutorial']
        },
        {
          title: `${niche} Before vs After Transformation`,
          description: `Dramatic transformation video showing the difference in results before and after applying your ${niche} technique. Use the popular side-by-side or quick transition format.`,
          tags: [`${niche}`, 'transformation', 'beforeafter', 'results']
        },
        {
          title: `I Tried This ${niche} Trick For 7 Days`,
          description: `Quick results video showing what happened when you tried a specific ${niche} technique consistently. Include day-by-day progress shots with text overlay for each day.`,
          tags: [`${niche}`, 'challenge', '7days', 'results']
        },
        {
          title: `${niche} Life Hack That Actually Works`,
          description: `Demonstrate a practical, time-saving hack related to ${niche} with clear before/after results. Film with fast cuts and add surprised reaction at the end.`,
          tags: [`${niche}`, 'lifehack', 'timesaver', 'howto']
        },
        {
          title: `Secret ${niche} Tool Everyone Needs`,
          description: `Showcase an underrated tool or resource for ${niche} with quick demonstration of its effectiveness. Include text overlay with product details and where to find it.`,
          tags: [`${niche}`, 'tool', 'musthave', 'recommendation']
        },
        {
          title: `${niche} Expectation vs Reality`,
          description: `Humorous comparison between what people expect with ${niche} and what actually happens. Use split screen or quick cuts between expectation and reality scenarios.`,
          tags: [`${niche}`, 'expectationvsreality', 'funny', 'relatable']
        },
        {
          title: `This ${niche} Technique Changed Everything`,
          description: `Dramatic reveal of a game-changing technique for ${niche}. Film with a hook opening, then quick tutorial, and show impressive results at the end.`,
          tags: [`${niche}`, 'technique', 'gamechanger', 'tutorial']
        },
        {
          title: `Why Your ${niche} Isn't Working (Fixed It!)`,
          description: `Identify a common problem people face with ${niche} and demonstrate the solution. Use problem/solution format with clear visual indicators.`,
          tags: [`${niche}`, 'problemsolving', 'fix', 'solution']
        },
        {
          title: `POV: When Your ${niche} Finally Clicks`,
          description: `Point-of-view style video showing the moment of realization or success with ${niche}. Include relatable reaction and text explaining the "aha" moment.`,
          tags: [`${niche}`, 'pov', 'success', 'relatable']
        }
      ];
      
      // Shuffle ideas and take requested number
      return [...ideas].sort(() => 0.5 - Math.random()).slice(0, count);
    }
    
    // Copy shorts idea
    function copyShortsIdea(button) {
      const container = button.closest('.shorts-idea-container');
      const title = container.querySelector('.shorts-idea-title').textContent;
      const description = container.querySelector('.shorts-idea-content').textContent;
      
      const textToCopy = `${title}\n\n${description}`;
      
      navigator.clipboard.writeText(textToCopy)
        .then(() => {
          showToast('Shorts idea copied to clipboard');
        })
        .catch(err => {
          showToast('Failed to copy shorts idea');
        });
    }
    
    // Add shorts to planner
    function addShortsToPlanner(title) {
      // Switch to planner screen
      switchScreen('content-planner-screen');
      
      // Open add content modal
      showModal('addContentModal');
      
      // Set title, date, and mark as shorts
      document.getElementById('contentTitle').value = `[SHORTS] ${title}`;
      document.getElementById('contentDate').valueAsDate = new Date();
      document.getElementById('contentTags').value = 'shorts, vertical, 60-seconds';
      
      showToast('Added to content planner');
    }
    
    // Export shorts ideas
    function exportShortsIdeas() {
      const shortsContainer = document.getElementById('shortsContainer');
      
      if (!shortsContainer || !shortsContainer.children.length) {
        showToast('No shorts ideas available');
        return;
      }
      
      // Create text content from ideas
      let content = 'YOUTUBE SHORTS IDEAS:\n\n';
      
      Array.from(shortsContainer.children).forEach((idea, index) => {
        const title = idea.querySelector('.shorts-idea-title').textContent;
        const description = idea.querySelector('.shorts-idea-content').textContent;
        const tags = Array.from(idea.querySelectorAll('.shorts-idea-tag')).map(tag => tag.textContent).join(', ');
        
        content += `${index + 1}. ${title}\n`;
        content += `   ${description}\n`;
        content += `   Tags: ${tags}\n\n`;
      });
      
      const blob = new Blob([content], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      
      const a = document.createElement('a');
      a.href = url;
      a.download = 'shorts_ideas.txt';
      a.click();
      
      showToast('Shorts ideas exported');
    }

    // Enable dark mode
    function enableDarkMode() {
      document.body.classList.add('dark-mode');
      document.getElementById('darkModeToggle').checked = true;
    }

    // Disable dark mode
    function disableDarkMode() {
      document.body.classList.remove('dark-mode');
      document.getElementById('darkModeToggle').checked = false;
    }

    // Switch screen
    function switchScreen(screenId) {
      document.querySelectorAll('.tab-content').forEach(screen => {
        screen.classList.remove('active');
      });
      document.getElementById(screenId).classList.add('active');
      
      document.querySelectorAll('.nav-item').forEach(navItem => {
        navItem.classList.remove('active');
        if (navItem.getAttribute('data-screen') === screenId) {
          navItem.classList.add('active');
        }
      });

      // Reset AI Tool tabs when navigating to AI Tools screen
      if (screenId === 'ai-tools-screen') {
          // Default to description tab
          document.querySelectorAll('#ai-tools-screen .tabs-container .tab').forEach(t => t.classList.remove('active'));
          document.querySelector('#ai-tools-screen .tabs-container .tab[data-ai-tool="description"]').classList.add('active');
          document.querySelectorAll('#ai-tools-screen .tab-content').forEach(c => c.classList.remove('active'));
          document.getElementById('ai-description-tool-content').classList.add('active');
          document.getElementById('aiToolResults').style.display = 'none'; // Hide results
          document.getElementById('descriptionTopic').value = ''; // Clear inputs
          document.getElementById('descriptionDetails').value = '';
          document.getElementById('titleTopic').value = '';
      }
      
      // Reset Watch Video screen when navigating away from it
      if (screenId !== 'watch-video-screen') {
          document.getElementById('videoPlayerCard').style.display = 'none';
          document.getElementById('relatedVideosCard').style.display = 'none';
          document.getElementById('watchVideoSearchResults').style.display = 'none';
          document.getElementById('watchVideoSearch').value = '';
          watchSearchResultsNextPageToken = null;
          currentWatchVideoId = null;
          // Clear the iframe src to stop playback
          document.getElementById('videoPlayer').src = '';
      }
    }

    // Show toast notification
    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.style.display = 'block';
      
      setTimeout(() => {
        toast.style.display = 'none';
      }, 3000);
    }

    // Show modal
    function showModal(modalId) {
      document.getElementById('modalBackdrop').style.display = 'block';
      document.getElementById(modalId).style.display = 'block';
    }

    // Hide modal
    function hideModal(modalId) {
      document.getElementById('modalBackdrop').style.display = 'none';
      document.getElementById(modalId).style.display = 'none';
    }

    // Extract Video ID from various YouTube URLs
    function extractVideoId(url) {
      if (!url) return null;
      
      // Regular URL format
      let match = url.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/);
      
      // If not found, try mobile or shorts URL format
      if (!match) {
        match = url.match(/(?:youtube\.com\/shorts\/)([^"&?\/\s]{11})/);
      }
      
      return match ? match[1] : null;
    }

    // Format large numbers
    function formatNumber(num) {
      if (num >= 1000000) {
        return (num / 1000000).toFixed(1) + 'M';
      } else if (num >= 1000) {
        return (num / 1000).toFixed(1) + 'K';
      } else {
        return num.toString();
      }
    }

    // Copy to clipboard
    function copyToClipboard(elementId) {
      const element = document.getElementById(elementId);
      const text = element.textContent;
      
      navigator.clipboard.writeText(text)
        .then(() => {
          showToast('Copied to clipboard');
        })
        .catch(err => {
          showToast('Failed to copy: ' + err);
        });
    }

    // Paste from clipboard
    function pasteFromClipboard(elementId) {
      navigator.clipboard.readText()
        .then(text => {
          document.getElementById(elementId).value = text;
          
          // If pasting to thumbnail URL, update the preview
          if (elementId === 'thumbnailUrl') {
            updateThumbnailPreview();
          }
          
          // If pasting to watch video search bar, load video
          if (elementId === 'watchVideoSearch') {
              loadWatchVideoFromSearchInput();
          }

          showToast('Pasted from clipboard');
        })
        .catch(err => {
          showToast('Failed to read from clipboard');
        });
    }

    // Update thumbnail preview
    function updateThumbnailPreview() {
      const url = document.getElementById('thumbnailUrl').value.trim();
      const videoId = extractVideoId(url);
      
      if (videoId) {
        const quality = document.querySelector('#thumbnail-screen .tabs-container .tab.active').getAttribute('data-quality');
        const thumbnailUrl = `https://img.youtube.com/vi/${videoId}/${quality}.jpg`;
        
        document.getElementById('previewImage').src = thumbnailUrl;
        document.getElementById('thumbnailPreview').style.display = 'block';
      } else {
        document.getElementById('thumbnailPreview').style.display = 'none';
      }
    }

    // Download thumbnail
    function downloadThumbnail() {
      let url;
      
      // Check if we're on the thumbnail screen or using the action from metadata results
      if (document.getElementById('thumbnail-screen').classList.contains('active')) {
        url = document.getElementById('thumbnailUrl').value.trim();
      } else if (currentMetadata) {
        url = `https://www.youtube.com/watch?v=${currentMetadata.id}`;
      } else {
        showToast('No video selected');
        return;
      }
      
      const videoId = extractVideoId(url);
      
      if (!videoId) {
        showToast('Invalid YouTube URL');
        return;
      }
      
      const quality = document.querySelector('#thumbnail-screen .tabs-container .tab.active')?.getAttribute('data-quality') || 'maxresdefault';
      const thumbnailUrl = `https://img.youtube.com/vi/${videoId}/${quality}.jpg`;
      
      const a = document.createElement('a');
      a.href = thumbnailUrl;
      a.download = `yt_thumbnail_${videoId}_${quality}.jpg`;
      a.click();
      
      showToast('Thumbnail downloaded');
    }

    // Extract metadata
    function extractMetadata() {
      const videoUrl = document.getElementById('videoUrl').value.trim();
      const videoId = extractVideoId(videoUrl);
      
      if (!videoId) {
        showToast('Invalid YouTube URL');
        return;
      }
      
      // Show loading
      document.getElementById('extractProgress').style.display = 'block';
      document.getElementById('metadataResults').style.display = 'none';
      
      // Fetch video data from YouTube API
      fetchVideoData(videoId);
    }
    
    // Fetch video data from YouTube API
    function fetchVideoData(videoId) {
      // Create the YouTube API URL
      const apiUrl = `https://www.googleapis.com/youtube/v3/videos?id=${videoId}&part=snippet,statistics&key=${API_KEY}`;
      
      fetch(apiUrl)
        .then(response => {
          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
          return response.json();
        })
        .then(data => {
          if (data.items && data.items.length > 0) {
            // Extract information from the API response
            const videoInfo = data.items[0];
            const snippet = videoInfo.snippet;
            const statistics = videoInfo.statistics;
            
            // Update UI with real data
            document.getElementById('videoTitle').textContent = snippet.title;
            document.getElementById('videoDescription').textContent = snippet.description;
            document.getElementById('videoChannel').textContent = snippet.channelTitle;
            
            // Process tags
            const tags = snippet.tags || [];
            //currentTags = tags; // This variable is not used anywhere else
            document.getElementById('videoTags').textContent = tags.join(', ');
            
            // Create tags UI
            const tagsContainer = document.getElementById('videoTagsContainer');
            tagsContainer.innerHTML = '';
            
            tags.forEach(tag => {
              const tagElement = document.createElement('div');
              tagElement.className = 'tag';
              tagElement.innerHTML = `
                ${tag}
                <i class="fas fa-copy" onclick="copyTagToClipboard('${tag.replace(/'/g, "\\'")}')"></i>
              `;
              tagsContainer.appendChild(tagElement);
            });
            
            // Set thumbnail
            const useHQ = document.getElementById('hqThumbnailToggle').checked;
            const thumbnailUrl = useHQ ? 
                              `https://img.youtube.com/vi/${videoId}/maxresdefault.jpg` : 
                              `https://img.youtube.com/vi/${videoId}/hqdefault.jpg`;
            
            document.getElementById('videoThumbnail').src = thumbnailUrl;
            document.getElementById('videoViews').textContent = formatNumber(parseInt(statistics.viewCount) || 0);
            document.getElementById('videoLikes').textContent = formatNumber(parseInt(statistics.likeCount) || 0);
            document.getElementById('videoComments').textContent = formatNumber(parseInt(statistics.commentCount) || 0);
            
            // Save current metadata
            currentMetadata = {
              id: videoId,
              title: snippet.title,
              description: snippet.description,
              tags: tags,
              channelId: snippet.channelId,
              channelTitle: snippet.channelTitle,
              publishedAt: snippet.publishedAt,
              thumbnail: thumbnailUrl,
              statistics: statistics
            };
            
            // Hide loading and show result
            document.getElementById('extractProgress').style.display = 'none';
            document.getElementById('metadataResults').style.display = 'block';
            
            // Add to history (metadata extraction is also a 'view' action)
            addToHistory(videoId, snippet.title, snippet.channelTitle);
          } else {
            throw new Error('No data found for the provided video ID');
          }
        })
        .catch(error => {
          console.error('Error fetching video data:', error);
          showToast('Error fetching video data: ' + error.message);
          document.getElementById('extractProgress').style.display = 'none';
        });
    }

    // Copy tag to clipboard
    function copyTagToClipboard(tag) {
      navigator.clipboard.writeText(tag)
        .then(() => {
          showToast('Tag copied to clipboard');
        })
        .catch(err => {
          showToast('Failed to copy tag');
        });
    }

    // Add video to history
    function addToHistory(videoId, title, channelName) {
      // Check if we should save history
      if (!userData.settings.saveHistory) return;
      
      // Check if video already exists in history
      const existingIndex = userData.videoHistory.findIndex(item => item.id === videoId);
      
      if (existingIndex !== -1) {
        // Move to the top of history
        const item = userData.videoHistory.splice(existingIndex, 1)[0];
        // Update last watched time
        item.lastWatched = new Date().toISOString();
        userData.videoHistory.unshift(item);
      } else {
        // Add new history item
        userData.videoHistory.unshift({
          id: videoId,
          title: title,
          channelName: channelName,
          lastWatched: new Date().toISOString()
        });
        
        // Limit history to 20 items
        if (userData.videoHistory.length > 20) {
          userData.videoHistory.pop();
        }
      }
      
      // Save to local storage
      saveUserData();
      
      // Update history display
      updateHistoryDisplay();
    }
    
    // Update history display
    function updateHistoryDisplay() {
      const historyGrid = document.getElementById('historyGrid');
      const historyContainer = document.getElementById('historyContainer');
      
      if (userData.videoHistory.length === 0) {
        historyContainer.style.display = 'none';
        return;
      }
      
      historyContainer.style.display = 'block';
      historyGrid.innerHTML = '';
      
      // Display up to 6 most recent videos
      const displayCount = Math.min(userData.videoHistory.length, 6);
      
      for (let i = 0; i < displayCount; i++) {
        const video = userData.videoHistory[i];
        const historyItem = document.createElement('div');
        historyItem.className = 'history-item';
        historyItem.innerHTML = `
          <img src="https://img.youtube.com/vi/${video.id}/mqdefault.jpg" class="history-thumbnail" alt="${video.title}">
          <div class="history-details">
            <div class="history-video-title">${video.title}</div>
            <div class="history-channel-name">${video.channelName}</div>
          </div>
        `;
        
        historyItem.addEventListener('click', () => {
          // When clicking history item, navigate to watch-video screen and load the video
          loadWatchVideo(video.id); // Load by ID
          switchScreen('watch-video-screen'); // Switch to the watch screen
        });
        
        historyGrid.appendChild(historyItem);
      }
    }
    
    // Clear history
    function clearHistory() {
      if (confirm('Are you sure you want to clear your watch history?')) {
        userData.videoHistory = [];
        saveUserData();
        updateHistoryDisplay();
        showToast('Watch history cleared');
      }
    }

    // Get video comments
    function getVideoComments() {
      const videoUrl = document.getElementById('commentsUrl').value.trim();
      const videoId = extractVideoId(videoUrl);
      
      if (!videoId) {
        showToast('Invalid YouTube URL');
        return;
      }
      
      // Show loading
      document.getElementById('commentsProgress').style.display = 'block';
      document.getElementById('commentsResults').style.display = 'none';
      
      // Get comments from YouTube API
      fetchVideoComments(videoId);
    }
    
    // Fetch video comments from YouTube API
    function fetchVideoComments(videoId) {
      const apiUrl = `https://www.googleapis.com/youtube/v3/commentThreads?part=snippet&videoId=${videoId}&maxResults=20&key=${API_KEY}`;
      
      fetch(apiUrl)
        .then(response => {
          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
          return response.json();
        })
        .then(data => {
          if (data.items && data.items.length > 0) {
            // Store comments
            currentComments = data.items;
            
            // Update UI
            updateCommentsUI();
            
            // Hide loading and show results
            document.getElementById('commentsProgress').style.display = 'none';
            document.getElementById('commentsResults').style.display = 'block';
          } else {
            showToast('No comments found for this video');
            document.getElementById('commentsProgress').style.display = 'none';
          }
        })
        .catch(error => {
          console.error('Error fetching comments:', error);
          showToast('Error fetching comments: ' + error.message);
          document.getElementById('commentsProgress').style.display = 'none';
        });
    }

    // Update comments UI
    function updateCommentsUI() {
      const commentsContainer = document.getElementById('commentsContainer');
      commentsContainer.innerHTML = '';
      
      if (currentComments.length === 0) {
        commentsContainer.innerHTML = '<div class="text-center p-3">No comments found</div>';
        return;
      }
      
      currentComments.forEach(thread => {
        const comment = thread.snippet.topLevelComment.snippet;
        
        const commentElement = document.createElement('div');
        commentElement.className = 'comment-item';
        commentElement.innerHTML = `
          <div class="comment-header">
            <img src="${comment.authorProfileImageUrl}" class="comment-avatar" alt="User Avatar">
            <div class="comment-author">${comment.authorDisplayName}</div>
            <div class="comment-date">${new Date(comment.publishedAt).toLocaleDateString()}</div>
          </div>
          <div class="comment-text">${comment.textDisplay}</div>
          <div class="comment-stats">
            <span><i class="fas fa-thumbs-up"></i> ${comment.likeCount}</span>
            <span><i class="fas fa-reply"></i> ${thread.snippet.totalReplyCount}</span>
            <button class="copy-btn" style="margin-left: auto;" onclick="copyCommentToClipboard(this.parentNode.parentNode)">
              <i class="fas fa-copy"></i>
            </button>
          </div>
        `;
        
        commentsContainer.appendChild(commentElement);
      });
    }

    // Copy comment to clipboard
    function copyCommentToClipboard(commentElement) {
      const commentText = commentElement.querySelector('.comment-text').textContent;
      
      navigator.clipboard.writeText(commentText)
        .then(() => {
          showToast('Comment copied to clipboard');
        })
        .catch(err => {
          showToast('Failed to copy comment');
        });
    }

    // Load more comments
    function loadMoreComments() {
      // Show loading
      document.getElementById('commentsProgress').style.display = 'block';
      
      // Get the current video ID
      const videoUrl = document.getElementById('commentsUrl').value.trim();
      const videoId = extractVideoId(videoUrl);
      
      if (!videoId) {
        showToast('Invalid YouTube URL');
        document.getElementById('commentsProgress').style.display = 'none';
        return;
      }
      
      // Get next page token if available
      let nextPageToken = '';
      if (currentComments && currentComments.length > 0) {
        // Check if we have a next page token stored
        nextPageToken = window.commentNextPageToken || '';
      }
      
      // Fetch more comments
      const apiUrl = `https://www.googleapis.com/youtube/v3/commentThreads?part=snippet&videoId=${videoId}&maxResults=10&key=${API_KEY}${nextPageToken ? '&pageToken=' + nextPageToken : ''}`;
      
      fetch(apiUrl)
        .then(response => {
          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
          return response.json();
        })
        .then(data => {
          // Hide loading
          document.getElementById('commentsProgress').style.display = 'none';
          
          if (data.items && data.items.length > 0) {
            // Store next page token if available
            if (data.nextPageToken) {
              window.commentNextPageToken = data.nextPageToken;
            } else {
              window.commentNextPageToken = null;
              // If no more comments are available, hide the load more button
              document.getElementById('loadMoreCommentsBtn').style.display = 'none';
            }
            
            // Add new comments to the existing ones
            currentComments = [...currentComments, ...data.items];
            
            // Update UI with all comments
            updateCommentsUI();
            
            showToast(`Loaded ${data.items.length} more comments`);
          } else {
            showToast('No more comments available');
            document.getElementById('loadMoreCommentsBtn').style.display = 'none';
          }
        })
        .catch(error => {
          console.error('Error loading more comments:', error);
          showToast('Error loading more comments: ' + error.message);
          document.getElementById('commentsProgress').style.display = 'none';
        });
    }

    // Search comments
    function searchComments() {
      const searchTerm = document.getElementById('commentsSearch').value.toLowerCase().trim();
      
      if (!searchTerm) {
        updateCommentsUI();
        return;
      }
      
      const filteredComments = currentComments.filter(thread => {
        const comment = thread.snippet.topLevelComment.snippet;
        return comment.textDisplay.toLowerCase().includes(searchTerm) ||
               comment.authorDisplayName.toLowerCase().includes(searchTerm);
      });
      
      const commentsContainer = document.getElementById('commentsContainer');
      commentsContainer.innerHTML = '';
      
      if (filteredComments.length === 0) {
        commentsContainer.innerHTML = '<div class="text-center p-3">No matching comments found</div>';
        return;
      }
      
      filteredComments.forEach(thread => {
        const comment = thread.snippet.topLevelComment.snippet;
        
        const commentElement = document.createElement('div');
        commentElement.className = 'comment-item';
        commentElement.innerHTML = `
          <div class="comment-header">
            <img src="${comment.authorProfileImageUrl}" class="comment-avatar" alt="User Avatar">
            <div class="comment-author">${comment.authorDisplayName}</div>
            <div class="comment-date">${new Date(comment.publishedAt).toLocaleDateString()}</div>
          </div>
          <div class="comment-text">${comment.textDisplay}</div>
          <div class="comment-stats">
            <span><i class="fas fa-thumbs-up"></i> ${comment.likeCount}</span>
            <span><i class="fas fa-reply"></i> ${thread.snippet.totalReplyCount}</span>
            <button class="copy-btn" style="margin-left: auto;" onclick="copyCommentToClipboard(this.parentNode.parentNode)">
              <i class="fas fa-copy"></i>
            </button>
          </div>
        `;
        
        commentsContainer.appendChild(commentElement);
      });
    }

    // Apply comments filter
    function applyCommentsFilter() {
      showToast('Filter applied');
      searchComments();
    }

    // Reset comments filter
    function resetCommentsFilter() {
      document.getElementById('showRepliesToggle').checked = true;
      document.getElementById('commentSort').value = 'relevance';
      document.getElementById('minLikes').value = '0';
      document.getElementById('hasQuestionToggle').checked = false;
      
      showToast('Filter reset');
    }

    // Get keyword suggestions
    function getKeywordSuggestions() {
      const keyword = document.getElementById('keywordInput').value.trim();
      
      if (!keyword) {
        showToast('Please enter a keyword');
        return;
      }
      
      // Show loading
      document.getElementById('keywordProgress').style.display = 'block';
      document.getElementById('keywordResults').style.display = 'none';
      
      // Simulate API call
      setTimeout(() => {
        // Hide loading
        document.getElementById('keywordProgress').style.display = 'none';
        
        // Generate related keywords
        const relatedKeywords = generateRelatedKeywords(keyword);
        currentKeywords = relatedKeywords; // This variable is not used anywhere else
        
        // Update UI
        const keywordsContainer = document.getElementById('keywordsContainer');
        keywordsContainer.innerHTML = '';
        
        relatedKeywords.forEach(kw => {
          const keywordElement = document.createElement('div');
          keywordElement.className = 'tag';
          keywordElement.innerHTML = `
            ${kw}
            <i class="fas fa-copy" onclick="copyTagToClipboard('${kw.replace(/'/g, "\\'")}')"></i>
          `;
          keywordsContainer.appendChild(keywordElement);
        });
        
        document.getElementById('keywordsList').textContent = relatedKeywords.join(', ');
        
        // Show result
        document.getElementById('keywordResults').style.display = 'block';
      }, 1500);
    }

    // Generate related keywords
    function generateRelatedKeywords(keyword) {
      const baseKeywords = [
        'tutorial', 'guide', 'how to', 'tips', 'tricks', 'beginner', 'advanced',
        'review', 'best', 'top', 'comparison', 'vs', 'alternative', 'cheap',
        'free', 'premium', 'professional', 'easy', 'quick', 'simple',
        '2024', '2025', 'new', 'latest', 'updated'
      ];
      
      const keywords = [];
      
      // Add variations of the main keyword
      keywords.push(keyword);
      keywords.push(`best ${keyword}`);
      keywords.push(`${keyword} tutorial`);
      keywords.push(`how to ${keyword}`);
      keywords.push(`${keyword} guide`);
      keywords.push(`${keyword} tips`);
      keywords.push(`${keyword} for beginners`);
      keywords.push(`advanced ${keyword}`);
      keywords.push(`${keyword} 2024`);
      keywords.push(`${keyword} review`);
      
      // Add some random combinations
      for (let i = 0; i < 10; i++) {
        const randomBase = baseKeywords[Math.floor(Math.random() * baseKeywords.length)];
        if (Math.random() > 0.5) {
          keywords.push(`${keyword} ${randomBase}`);
        } else {
          keywords.push(`${randomBase} ${keyword}`);
        }
      }
      
      // Return unique keywords
      return [...new Set(keywords)];
    }

    // Export metadata
    function exportMetadata() {
      if (!currentMetadata) {
        showToast('No metadata available');
        return;
      }
      
      const metadataObj = {
        id: currentMetadata.id,
        title: currentMetadata.title,
        description: currentMetadata.description,
        tags: currentMetadata.tags,
        channel: currentMetadata.channelTitle,
        channelId: currentMetadata.channelId,
        publishedAt: currentMetadata.publishedAt,
        views: currentMetadata.statistics.viewCount,
        likes: currentMetadata.statistics.likeCount,
        comments: currentMetadata.statistics.commentCount,
        exported: new Date().toISOString()
      };
      
      const jsonString = JSON.stringify(metadataObj, null, 2);
      const blob = new Blob([jsonString], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      
      const a = document.createElement('a');
      a.href = url;
      a.download = `metadata_${currentMetadata.id}.json`;
      a.click();
      
      showToast('Metadata exported');
    }

    // Export comments
    function exportComments() {
      if (currentComments.length === 0) {
        showToast('No comments available');
        return;
      }
      
      const commentsData = currentComments.map(thread => {
        const comment = thread.snippet.topLevelComment.snippet;
        return {
          author: comment.authorDisplayName,
          text: comment.textDisplay,
          likes: comment.likeCount,
          date: comment.publishedAt,
          replies: thread.snippet.totalReplyCount
        };
      });
      
      const jsonString = JSON.stringify(commentsData, null, 2);
      const blob = new Blob([jsonString], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      
      const a = document.createElement('a');
      a.href = url;
      a.download = 'comments.json';
      a.click();
      
      showToast('Comments exported');
    }

    // Export keywords
    function exportKeywords() {
      // currentKeywords is not defined in the provided code block, assuming it's meant to be used.
      if (!currentKeywords || currentKeywords.length === 0) {
        showToast('No keywords available');
        return;
      }
      
      const textContent = currentKeywords.join('\n');
      const blob = new Blob([textContent], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      
      const a = document.createElement('a');
      a.href = url;
      a.download = 'keywords.txt';
      a.click();
      
      showToast('Keywords exported');
    }

    // Export transcript
    function exportTranscript() {
      const transcriptContent = document.getElementById('transcriptContent').textContent;
      
      if (!transcriptContent || transcriptContent.trim() === '') {
        showToast('No transcript available');
        return;
      }
      
      const blob = new Blob([transcriptContent], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      
      const a = document.createElement('a');
      a.href = url;
      a.download = 'transcript.txt';
      a.click();
      
      showToast('Transcript exported');
    }

    // View comments (from metadata screen)
    function viewComments() {
      if (!currentMetadata) {
        showToast('No video metadata available');
        return;
      }
      
      document.getElementById('commentsUrl').value = `https://www.youtube.com/watch?v=${currentMetadata.id}`;
      switchScreen('comments-screen');
      getVideoComments();
    }

    // Load watch video (called when a video ID is known)
    function loadWatchVideo(videoId) {
        if (!videoId) {
            showToast('No video ID provided for playback.');
            return;
        }

        // Clear search results and player elements from previous video
        document.getElementById('watchVideoSearchResults').style.display = 'none';
        document.getElementById('watchSearchResultsContent').innerHTML = '';
        document.getElementById('loadMoreWatchResultsBtn').style.display = 'none';

        // Clear previous video player if it was visible
        document.getElementById('videoPlayerCard').style.display = 'none';
        document.getElementById('relatedVideosCard').style.display = 'none';
        document.getElementById('videoPlayer').src = ''; // Stop current video

        currentWatchVideoId = videoId; // Store the ID of the video being loaded

        // Create embed URL with autoplay parameter based on user setting
        const autoplay = userData.settings.autoplay ? 1 : 0;
        const embedUrl = `https://www.youtube.com/embed/${videoId}?autoplay=${autoplay}&rel=0`;
        
        // Update iframe and show player
        document.getElementById('videoPlayer').src = embedUrl;
        document.getElementById('videoPlayerCard').style.display = 'block';
        
        // Show loading state for metadata
        document.getElementById('watchVideoTitle').textContent = 'Loading video information...';
        document.getElementById('watchChannelName').textContent = 'Loading...';
        document.getElementById('watchVideoViews').textContent = 'Loading...';
        document.getElementById('watchVideoDate').textContent = '';
        document.getElementById('watchVideoDescription').textContent = 'Loading video description...';
        document.getElementById('watchChannelImg').src = '';
        
        // Fetch video info from YouTube API
        const apiUrl = `https://www.googleapis.com/youtube/v3/videos?id=${videoId}&part=snippet,statistics&key=${API_KEY}`;
        
        fetch(apiUrl)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                if (data.items && data.items.length > 0) {
                    // Extract information from the API response
                    const videoInfo = data.items[0];
                    const snippet = videoInfo.snippet;
                    const statistics = videoInfo.statistics;
                    
                    // Format date
                    const publishDate = new Date(snippet.publishedAt);
                    
                    // Update UI with real data
                    document.getElementById('watchVideoTitle').textContent = snippet.title;
                    document.getElementById('watchChannelName').textContent = snippet.channelTitle;
                    document.getElementById('watchVideoViews').textContent = `${formatNumber(parseInt(statistics.viewCount) || 0)} views`;
                    document.getElementById('watchVideoDate').textContent = publishDate.toLocaleDateString();
                    document.getElementById('watchVideoDescription').textContent = snippet.description;
                    
                    // Make sure description is collapsed
                    document.getElementById('watchVideoDescription').classList.add('collapsed');
                    document.getElementById('showMoreDescBtn').textContent = 'SHOW MORE';
                    
                    // Fetch channel thumbnail
                    fetchChannelThumbnail(snippet.channelId);
                    
                    // Load related videos
                    loadRelatedVideos(videoId);
                    
                    // Show the related videos card
                    document.getElementById('relatedVideosCard').style.display = 'block';
                    
                    // Add to history
                    if (userData.settings.saveHistory) {
                        addToHistory(videoId, snippet.title, snippet.channelTitle);
                    }
                } else {
                    throw new Error('No data found for the provided video ID');
                }
            })
            .catch(error => {
                console.error('Error fetching video data:', error);
                showToast('Error fetching video data: ' + error.message);
                
                // Set default values in case of error
                document.getElementById('watchVideoTitle').textContent = 'Video information unavailable';
                document.getElementById('watchChannelName').textContent = 'Unknown channel';
                document.getElementById('watchVideoViews').textContent = '0 views';
                document.getElementById('watchVideoDate').textContent = 'Unknown date';
                document.getElementById('watchVideoDescription').textContent = 'Video description unavailable.';
                document.getElementById('videoPlayer').src = ''; // Clear iframe on error
            });
    }
    
    // Fetch channel thumbnail
    function fetchChannelThumbnail(channelId) {
      const apiUrl = `https://www.googleapis.com/youtube/v3/channels?id=${channelId}&part=snippet&key=${API_KEY}`;
      
      fetch(apiUrl)
        .then(response => {
          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
          return response.json();
        })
        .then(data => {
          if (data.items && data.items.length > 0) {
            const channelInfo = data.items[0];
            const thumbnailUrl = channelInfo.snippet.thumbnails.default.url;
            
            // Update channel image
            document.getElementById('watchChannelImg').src = thumbnailUrl;
          }
        })
        .catch(error => {
          console.error('Error fetching channel data:', error);
          // Use a default image in case of error
          document.getElementById('watchChannelImg').src = 'https://i.imgur.com/tdi3NGa.png';
        });
    }
    
    // Get current watch video ID
    function getCurrentWatchVideoId() {
      return currentWatchVideoId;
    }
    
    // Load related videos
    function loadRelatedVideos(videoId) {
      const relatedVideosContainer = document.getElementById('relatedVideosContainer');
      
      // Show loading state
      relatedVideosContainer.innerHTML = '<div class="text-center p-3">Loading related videos...</div>';
      
      // Fetch related videos from YouTube API
      // Note: Search API is the best approximation for related videos since the "related" parameter was deprecated
      const apiUrl = `https://www.googleapis.com/youtube/v3/search?part=snippet&relatedToVideoId=${videoId}&type=video&maxResults=10&key=${API_KEY}`;
      
      fetch(apiUrl)
        .then(response => {
          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
          return response.json();
        })
        .then(data => {
          relatedVideosContainer.innerHTML = '';
          
          if (data.items && data.items.length > 0) {
            data.items.forEach(item => {
              // Skip items without valid videoId
              if (!item.id || !item.id.videoId) return;
              
              const vidId = item.id.videoId;
              const videoTitle = item.snippet.title;
              const channelName = item.snippet.channelTitle;
              const publishDate = new Date(item.snippet.publishedAt);
              
              const videoElement = document.createElement('div');
              videoElement.className = 'video-item';
              videoElement.innerHTML = `
                <img src="https://img.youtube.com/vi/${vidId}/mqdefault.jpg" class="video-thumbnail" alt="${videoTitle}">
                <div class="video-details">
                  <div class="video-title">${videoTitle}</div>
                  <div class="video-channel">${channelName}</div>
                  <div class="video-info-row">
                    <span><i class="fas fa-calendar-alt"></i> ${publishDate.toLocaleDateString()}</span>
                  </div>
                </div>
              `;
              
              videoElement.addEventListener('click', () => {
                loadWatchVideo(vidId); // Load the new video
                // Scroll to top of watch-video-screen
                document.querySelector('.app-content').scrollTo(0, 0);
              });
              
              relatedVideosContainer.appendChild(videoElement);
            });
          } else {
            relatedVideosContainer.innerHTML = '<div class="text-center p-3">No related videos found</div>';
          }
        })
        .catch(error => {
          console.error('Error fetching related videos:', error);
          relatedVideosContainer.innerHTML = '<div class="text-center p-3">Error loading related videos</div>';
        });
    }

    // Search videos for the Watch Video Screen
    function searchVideosForWatchScreen(query, append = false) {
        // Clear previous results unless appending
        if (!append) {
            document.getElementById('watchSearchResultsContent').innerHTML = '';
            document.getElementById('videoPlayerCard').style.display = 'none';
            document.getElementById('relatedVideosCard').style.display = 'none';
            watchSearchResultsNextPageToken = null;
            currentWatchVideoId = null;
        }

        document.getElementById('loadingProgress').style.display = 'block'; // Use global loading indicator for search

        const apiUrl = `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(query)}&type=video&maxResults=10&key=${API_KEY}${watchSearchResultsNextPageToken ? '&pageToken=' + watchSearchResultsNextPageToken : ''}`;
        
        fetch(apiUrl)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                document.getElementById('loadingProgress').style.display = 'none';
                
                const searchResultsContainer = document.getElementById('watchVideoSearchResults');
                const searchResultsContent = document.getElementById('watchSearchResultsContent');
                searchResultsContainer.style.display = 'block';

                if (data.items && data.items.length > 0) {
                    data.items.forEach(item => {
                        if (!item.id || !item.id.videoId) return;
                        
                        const videoId = item.id.videoId;
                        const videoTitle = item.snippet.title;
                        const channelName = item.snippet.channelTitle;
                        const thumbnailUrl = item.snippet.thumbnails.medium ? item.snippet.thumbnails.medium.url : `https://img.youtube.com/vi/${videoId}/mqdefault.jpg`;
                        
                        const videoElement = document.createElement('div');
                        videoElement.className = 'video-item';
                        videoElement.innerHTML = `
                            <img src="${thumbnailUrl}" class="video-thumbnail" alt="${videoTitle}">
                            <div class="video-details">
                                <div class="video-title">${videoTitle}</div>
                                <div class="video-channel">${channelName}</div>
                            </div>
                        `;
                        
                        videoElement.addEventListener('click', () => {
                            loadWatchVideo(videoId); // Load the clicked video into the player
                        });
                        
                        searchResultsContent.appendChild(videoElement);
                    });

                    // Manage "Load More" button
                    if (data.nextPageToken) {
                        watchSearchResultsNextPageToken = data.nextPageToken;
                        document.getElementById('loadMoreWatchResultsBtn').style.display = 'block';
                    } else {
                        watchSearchResultsNextPageToken = null;
                        document.getElementById('loadMoreWatchResultsBtn').style.display = 'none';
                    }

                    if (!append) showToast(`Found ${data.pageInfo.totalResults} videos.`);
                    else showToast(`Loaded more videos.`);

                } else {
                    if (!append) searchResultsContent.innerHTML = '<div class="text-center p-3">No videos found for this search.</div>';
                    document.getElementById('loadMoreWatchResultsBtn').style.display = 'none';
                }
            })
            .catch(error => {
                console.error('Error searching videos:', error);
                document.getElementById('loadingProgress').style.display = 'none';
                showToast('Error searching videos: ' + error.message);
                if (!append) document.getElementById('watchSearchResultsContent').innerHTML = '<div class="text-center p-3">Error loading search results.</div>';
            });
    }

    // Function to handle search input on the watch page
    function loadWatchVideoFromSearchInput() {
        const query = document.getElementById('watchVideoSearch').value.trim();
        if (!query) {
            showToast('Please enter a video title or URL.');
            return;
        }

        const videoId = extractVideoId(query);
        if (videoId) {
            loadWatchVideo(videoId); // Directly load if it's a URL
        } else {
            searchVideosForWatchScreen(query); // Search if it's a keyword
        }
    }

    // Clear all data
    function clearAllData() {
      // Clear history
      userData.videoHistory = [];
      
      // Reset settings to defaults
      userData.settings = {
        darkMode: document.body.classList.contains('dark-mode'),
        hqThumbnail: true,
        saveHistory: true,
        autoplay: true
      };
      
      // Update UI
      updateHistoryDisplay();
      
      // Clear content planner
      contentPlanItems = [];
      updateContentPlannerView();
      
      // Save to localStorage
      saveUserData();
      
      showToast('All data cleared');
    }

    // Generate descriptions - local implementation
    function generateDescriptions() {
      const topic = document.getElementById('descriptionTopic').value.trim();
      const details = document.getElementById('descriptionDetails').value.trim();
      
      if (!topic) {
        showToast('Please enter a video topic');
        return;
      }
      
      // Show loading
      document.getElementById('aiToolProgress').style.display = 'block';
      document.getElementById('aiToolResults').style.display = 'none';
      
      const platform = document.querySelector('#ai-description-tool-content .platform-selector .platform-item.active').getAttribute('data-platform');
      
      // Simulate API response
      setTimeout(() => {
        // Hide loading
        document.getElementById('aiToolProgress').style.display = 'none';
        
        // Get platform-specific templates
        const templates = descriptionTemplates[platform] || descriptionTemplates.youtube;
        
        // Generate 3 descriptions
        const descriptions = [];
        
        // Pick 3 random templates
        const usedIndexes = new Set();
        while (descriptions.length < 3 && usedIndexes.size < templates.length) {
          const randomIndex = Math.floor(Math.random() * templates.length);
          
          if (!usedIndexes.has(randomIndex)) {
            usedIndexes.add(randomIndex);
            
            // Replace placeholders
            let description = templates[randomIndex]
              .replace(/{topic}/g, topic)
              .replace(/{detail}/g, details || topic)
              .replace(/{number}/g, Math.floor(Math.random() * 10) + 3);
            
            descriptions.push(description);
          }
        }
        
        // Display the descriptions
        const outputDiv = document.getElementById('aiToolOutputs');
        outputDiv.innerHTML = '';
        
        descriptions.forEach((desc, index) => {
          const outputItem = document.createElement('div');
          outputItem.className = 'output-item';
          outputItem.innerHTML = `
            <div>${desc}</div>
            <div class="output-actions">
              <button class="material-btn" onclick="copyOutput(this.parentNode.parentNode)">
                <i class="fas fa-copy me-1"></i> Copy
              </button>
            </div>
          `;
          outputDiv.appendChild(outputItem);
        });
        
        // Show results
        document.getElementById('aiToolResultsTitle').textContent = 'AI Generated Descriptions';
        document.getElementById('aiToolResults').style.display = 'block';
      }, 1500);
    }

    // Generate titles - local implementation
    function generateTitles() {
      const topic = document.getElementById('titleTopic').value.trim();
      
      if (!topic) {
        showToast('Please enter a video topic');
        return;
      }
      
      // Show loading
      document.getElementById('aiToolProgress').style.display = 'block';
      document.getElementById('aiToolResults').style.display = 'none';
      
      const platform = document.querySelector('#ai-title-tool-content .platform-selector .platform-item.active').getAttribute('data-platform');
      
      // Simulate API response
      setTimeout(() => {
        // Hide loading
        document.getElementById('aiToolProgress').style.display = 'none';
        
        // Get platform-specific templates
        const templates = titleTemplates[platform] || titleTemplates.youtube;
        
        // Generate 5 titles
        const titles = [];
        
        // Pick 5 random templates
        const usedIndexes = new Set();
        while (titles.length < 5 && usedIndexes.size < templates.length) {
          const randomIndex = Math.floor(Math.random() * templates.length);
          
          if (!usedIndexes.has(randomIndex)) {
            usedIndexes.add(randomIndex);
            
            // Replace placeholders
            let title = templates[randomIndex]
              .replace(/{topic}/g, topic)
              .replace(/{detail}/g, getRandomDetail(topic))
              .replace(/{number}/g, Math.floor(Math.random() * 10) + 3);
            
            titles.push(title);
          }
        }
        
        // Display the titles
        const outputDiv = document.getElementById('aiToolOutputs');
        outputDiv.innerHTML = '';
        
        titles.forEach((title, index) => {
          const outputItem = document.createElement('div');
          outputItem.className = 'output-item';
          outputItem.innerHTML = `
            <div style="font-weight: 500; font-size: 16px;">${title}</div>
            <div class="output-actions">
              <button class="material-btn" onclick="copyOutput(this.parentNode.parentNode)">
                <i class="fas fa-copy me-1"></i> Copy
              </button>
            </div>
          `;
          outputDiv.appendChild(outputItem);
        });
        
        // Show results
        document.getElementById('aiToolResultsTitle').textContent = 'AI Generated Titles';
        document.getElementById('aiToolResults').style.display = 'block';
      }, 1500);
    }
    
    // Generate random detail for title
    function getRandomDetail(topic) {
      const details = [
        'Beginner Guide',
        'Pro Tips',
        'Expert Advice',
        'Step-by-Step',
        'Complete Tutorial',
        'Quick Tips',
        'In-Depth Analysis',
        'Proven Methods',
        'Life-Changing',
        'Game-Changing',
        'Must-See',
        'Ultimate Guide'
      ];
      
      return details[Math.floor(Math.random() * details.length)];
    }
    
    // Generate AI Title from video metadata
    function generateAITitleFromMetadata() {
      if (!currentMetadata) {
        showToast('No video metadata available');
        return;
      }
      
      document.getElementById('titleTopic').value = currentMetadata.title;
      switchScreen('ai-tools-screen');
      // Switch to title tab within AI tools screen
      document.querySelectorAll('#ai-tools-screen .tabs-container .tab').forEach(t => t.classList.remove('active'));
      document.querySelector('#ai-tools-screen .tabs-container .tab[data-ai-tool="title"]').classList.add('active');
      document.querySelectorAll('#ai-tools-screen .tab-content').forEach(c => c.classList.remove('active'));
      document.getElementById('ai-title-tool-content').classList.add('active');

      generateTitles();
    }

    // Generate AI Description from video metadata
    function generateAIDescriptionFromMetadata() {
      if (!currentMetadata) {
        showToast('No video metadata available');
        return;
      }
      
      document.getElementById('descriptionTopic').value = currentMetadata.title;
      document.getElementById('descriptionDetails').value = currentMetadata.description;
      switchScreen('ai-tools-screen');
      // Switch to description tab within AI tools screen
      document.querySelectorAll('#ai-tools-screen .tabs-container .tab').forEach(t => t.classList.remove('active'));
      document.querySelector('#ai-tools-screen .tabs-container .tab[data-ai-tool="description"]').classList.add('active');
      document.querySelectorAll('#ai-tools-screen .tab-content').forEach(c => c.classList.remove('active'));
      document.getElementById('ai-description-tool-content').classList.add('active');

      generateDescriptions();
    }

    // Copy output (for AI-generated content)
    function copyOutput(element) {
      const text = element.querySelector('div:first-child').textContent;
      
      navigator.clipboard.writeText(text)
        .then(() => {
          showToast('Copied to clipboard');
        })
        .catch(err => {
          showToast('Failed to copy: ' + err);
        });
    }

    // Get transcript
    function getTranscript() {
      // Use URL from either dedicated transcript page or from metadata
      let videoUrl;
      
      if (document.getElementById('transcript-screen').classList.contains('active')) {
        videoUrl = document.getElementById('transcriptUrl').value.trim();
      } else if (currentMetadata) {
        videoUrl = `https://www.youtube.com/watch?v=${currentMetadata.id}`;
        document.getElementById('transcriptUrl').value = videoUrl;
        switchScreen('transcript-screen');
      } else {
        videoUrl = document.getElementById('transcriptUrl').value.trim();
      }
      
      const videoId = extractVideoId(videoUrl);
      
      if (!videoId) {
        showToast('Invalid YouTube URL');
        return;
      }
      
      // Show loading
      document.getElementById('transcriptProgress').style.display = 'block';
      document.getElementById('transcriptResults').style.display = 'none';
      
      // Simulate API response
      setTimeout(() => {
        // Hide loading
        document.getElementById('transcriptProgress').style.display = 'none';
        
        // Generate fake transcript
        const fakeTranscript = generateFakeTranscript();
        
        // Store the transcript and display it
        window.transcript = fakeTranscript;
        updateTranscriptFormat('text');
        
        // Show results
        document.getElementById('transcriptResults').style.display = 'block';
      }, 2000);
    }
    
    // Generate fake transcript
    function generateFakeTranscript() {
      const introLines = [
        "Hey everyone, welcome back to my channel!",
        "What's up guys, today we're diving into something really exciting.",
        "Hello and welcome! In this video, we're going to explore an interesting topic.",
        "Thanks for joining me today as we take a look at something pretty cool.",
        "Welcome back to another video! I'm really excited about today's topic."
      ];
      
      const middleLines = [
        "The first thing we need to understand is the basic concept. Let me explain how this works.",
        "Many people ask me about this all the time, so I thought it would be helpful to make a dedicated video.",
        "I've been using this technique for years, and it's completely changed how I approach things.",
        "There are several important factors to consider when you're getting started with this.",
        "Let's break this down step by step so you can follow along easily.",
        "What makes this really powerful is how versatile it can be for different situations.",
        "I want to show you a few examples of how this works in practice.",
        "The key thing to remember is that consistency is more important than perfection.",
        "Let me demonstrate this with a real-world example that you can relate to.",
        "This might seem complicated at first, but I promise it gets much easier with practice."
      ];
      
      const endLines = [
        "So that's basically everything you need to know to get started. Let me know if you have any questions!",
        "I hope this video has been helpful. If you enjoyed it, please hit that like button and subscribe for more content like this.",
        "Thanks so much for watching! Don't forget to check out my other videos for more tips and tutorials.",
        "That's it for today's video. I'll see you in the next one!",
        "If you want to learn more about this topic, I've included some helpful resources in the description below."
      ];
      
      // Randomly select lines
      const intro = introLines[Math.floor(Math.random() * introLines.length)];
      
      // Pick 10-15 random middle lines
      const numMiddleLines = 10 + Math.floor(Math.random() * 6);
      const middle = [];
      
      for (let i = 0; i < numMiddleLines; i++) {
        const randomIndex = Math.floor(Math.random() * middleLines.length);
        middle.push(middleLines[randomIndex]);
      }
      
      const end = endLines[Math.floor(Math.random() * endLines.length)];
      
      // Combine all parts
      return intro + "\n\n" + middle.join("\n\n") + "\n\n" + end;
    }

    // Update transcript format
    function updateTranscriptFormat(format) {
      if (!window.transcript) {
        return;
      }
      
      const transcriptContent = document.getElementById('transcriptContent');
      
      if (format === 'text') {
        // Clean text format - no timestamps
        transcriptContent.textContent = window.transcript;
      } else if (format === 'timestamps') {
        // Add timestamps
        const lines = window.transcript.split('\n\n').filter(line => line.trim() !== '');
        const formattedTranscript = [];
        let currentTime = 0;
        
        lines.forEach(line => {
          // Generate a timestamp (mm:ss) for each line
          const minutes = Math.floor(currentTime / 60);
          const seconds = Math.floor(currentTime % 60);
          const timestamp = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
          
          // Create a line with timestamp
          formattedTranscript.push(`<div class="transcript-line"><span class="timestamp">${timestamp}</span>${line}</div>`);
          
          // Increment time by 15-45 seconds per paragraph randomly
          currentTime += 15 + Math.floor(Math.random() * 30);
        });
        
        transcriptContent.innerHTML = formattedTranscript.join('');
      }
    }

    // Initialize content planner
    function initializeContentPlanner() {
      // Sample data
      contentPlanItems = [
        {
          id: 1,
          title: "YouTube SEO Tips for 2024",
          date: "2024-06-15",
          description: "Comprehensive guide to optimize YouTube videos for search in 2024.",
          tags: ["YouTube SEO", "Growth Tips", "Algorithm"],
          status: "planned"
        },
        {
          id: 2,
          title: "How to Edit Videos Like a Pro",
          date: "2024-06-20",
          description: "Tutorial on professional video editing techniques using free software.",
          tags: ["Video Editing", "Tutorial", "Beginner"],
          status: "ready"
        },
        {
          id: 3,
          title: "My YouTube Income Revealed",
          date: "2024-06-10",
          description: "Transparent breakdown of how much I earned from YouTube last month.",
          tags: ["YouTube Money", "Income Report", "Monetization"],
          status: "published"
        }
      ];
      
      updateContentPlannerView();
    }
    
    // Generate calendar
    function generateCalendar() {
      const calendarGrid = document.getElementById('calendarGrid');
      calendarGrid.innerHTML = '';
      
      // Add day headers
      const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
      days.forEach(day => {
        const dayHeader = document.createElement('div');
        dayHeader.className = 'calendar-header';
        dayHeader.textContent = day;
        calendarGrid.appendChild(dayHeader);
      });
      
      // Get the first day of the month
      const year = currentMonth.getFullYear();
      const month = currentMonth.getMonth();
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      
      // Update month display
      document.getElementById('currentMonth').textContent = 
        firstDay.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
      
      // Fill in blank spaces for days before the first day of month
      for (let i = 0; i < firstDay.getDay(); i++) {
        const emptyDay = document.createElement('div');
        emptyDay.className = 'calendar-day';
        emptyDay.style.visibility = 'hidden';
        calendarGrid.appendChild(emptyDay);
      }
      
      // Fill in the days of the month
      for (let i = 1; i <= lastDay.getDate(); i++) {
        const day = document.createElement('div');
        day.className = 'calendar-day';
        day.textContent = i;
        
        // Check if the day has content
        const currentDate = new Date(year, month, i);
        const dateString = currentDate.toISOString().split('T')[0];
        
        const hasContent = contentPlanItems.some(item => item.date === dateString);
        if (hasContent) {
          day.classList.add('has-content');
        }
        
        // Check if it's today
        const today = new Date();
        if (today.getFullYear() === year && today.getMonth() === month && today.getDate() === i) {
          day.classList.add('active');
        }
        
        // Add click event
        day.addEventListener('click', () => {
          // Set the date in the add content modal
          const selectedDate = new Date(year, month, i);
          document.getElementById('contentDate').valueAsDate = selectedDate;
          
          // Show modal
          showModal('addContentModal');
        });
        
        calendarGrid.appendChild(day);
      }
    }
    
    // Update content planner view
    function updateContentPlannerView() {
      const plannerContent = document.getElementById('plannerContent');
      plannerContent.innerHTML = '';
      
      // Get items for current month
      const year = currentMonth.getFullYear();
      const month = currentMonth.getMonth();
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      
      const monthItems = contentPlanItems.filter(item => {
        const itemDate = new Date(item.date);
        return itemDate >= firstDay && itemDate <= lastDay;
      });
      
      // Sort by date
      monthItems.sort((a, b) => new Date(a.date) - new Date(b.date));
      
      if (monthItems.length === 0) {
        plannerContent.innerHTML = '<div class="text-center p-3">No content planned for this month. Click on a date or use the "Add New Content" button to start planning.</div>';
        return;
      }
      
      // Create items
      monthItems.forEach(item => {
        const itemElement = document.createElement('div');
        itemElement.className = 'planner-item';
        
        // Format date
        const itemDate = new Date(item.date);
        const formattedDate = itemDate.toLocaleDateString('en-US', { 
          weekday: 'short', 
          month: 'short', 
          day: 'numeric' 
        });
        
        // Create tags
        const tagsHtml = item.tags.map(tag => `<div class="planner-tag">${tag}</div>`).join('');
        
        // Set status class
        let statusClass = '';
        let statusText = '';
        
        switch (item.status) {
          case 'planned':
            statusClass = 'status-planned';
            statusText = 'Planned';
            break;
          case 'ready':
            statusClass = 'status-ready';
            statusText = 'Ready to Publish';
            break;
          case 'published':
            statusClass = 'status-published';
            statusText = 'Published';
            break;
        }
        
        itemElement.innerHTML = `
          <div class="planner-date">${formattedDate}</div>
          <div class="planner-title">${item.title}</div>
          <div class="planner-description">${item.description}</div>
          <div class="planner-tags">${tagsHtml}</div>
          <div class="planner-actions">
            <div class="planner-status ${statusClass}">${statusText}</div>
            <button class="material-btn-outlined" onclick="editContentItem(${item.id})">
              <i class="fas fa-edit"></i>
            </button>
            <button class="material-btn-outlined" onclick="deleteContentItem(${item.id})">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        `;
        
        plannerContent.appendChild(itemElement);
      });
    }
    
    // Save content item
    function saveContentItem() {
      const title = document.getElementById('contentTitle').value.trim();
      const date = document.getElementById('contentDate').value;
      const description = document.getElementById('contentDescription').value.trim();
      const tagsInput = document.getElementById('contentTags').value.trim();
      const status = document.getElementById('contentStatus').value;
      
      if (!title || !date) {
        showToast('Title and date are required');
        return;
      }
      
      // Parse tags
      const tags = tagsInput.split(',').map(tag => tag.trim()).filter(tag => tag !== '');
      
      // Create new item
      const newItem = {
        id: Date.now(), // Use timestamp as unique ID
        title,
        date,
        description,
        tags,
        status
      };
      
      // Add to items
      contentPlanItems.push(newItem);
      
      // Update view
      generateCalendar();
      updateContentPlannerView();
      
      showToast('Content saved successfully');
      
      // Clear form
      document.getElementById('contentTitle').value = '';
      document.getElementById('contentDescription').value = '';
      document.getElementById('contentTags').value = '';
    }
    
    // Edit content item
    function editContentItem(id) {
      const item = contentPlanItems.find(item => item.id === id);
      
      if (!item) {
        showToast('Item not found');
        return;
      }
      
      // Fill form
      document.getElementById('contentTitle').value = item.title;
      document.getElementById('contentDate').value = item.date;
      document.getElementById('contentDescription').value = item.description;
      document.getElementById('contentTags').value = item.tags.join(', ');
      document.getElementById('contentStatus').value = item.status;
      
      // Remove the item (it will be re-added if saved)
      contentPlanItems = contentPlanItems.filter(item => item.id !== id);
      
      // Show modal
      showModal('addContentModal');
    }
    
    // Delete content item
    function deleteContentItem(id) {
      if (confirm('Are you sure you want to delete this item?')) {
        // Remove the item
        contentPlanItems = contentPlanItems.filter(item => item.id !== id);
        
        // Update view
        generateCalendar();
        updateContentPlannerView();
        
        showToast('Item deleted');
      }
    }

    // Check if dark mode is preferred (Initial load)
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
      document.body.classList.add('dark-mode');
    }

    // Listen for dark mode changes (System preference)
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
      if (event.matches) {
        enableDarkMode();
      } else {
        disableDarkMode();
      }
    });

    // Setup event listeners (refactored for new structure)
    function setupEventListeners() {
      // Bottom navigation
      document.querySelectorAll('.nav-item').forEach(item => {
        item.addEventListener('click', () => {
          document.querySelectorAll('.nav-item').forEach(navItem => {
            navItem.classList.remove('active');
          });
          item.classList.add('active');
          
          const screenId = item.getAttribute('data-screen');
          switchScreen(screenId);
        });
      });
      
      // Feature grid items (on home screen)
      document.getElementById('feature-extract-metadata').addEventListener('click', () => {
        switchScreen('metadata-extract-screen');
      });
      document.getElementById('feature-shorts').addEventListener('click', () => {
        switchScreen('shorts-screen');
      });
      document.getElementById('feature-revenue').addEventListener('click', () => {
        switchScreen('revenue-screen');
      });
      document.getElementById('feature-thumbnail').addEventListener('click', () => {
        switchScreen('thumbnail-screen');
      });
      document.getElementById('feature-comments').addEventListener('click', () => {
        switchScreen('comments-screen');
      });
      document.getElementById('feature-keyword').addEventListener('click', () => {
        switchScreen('keyword-screen');
      });
      document.getElementById('feature-ai-tools').addEventListener('click', () => {
        switchScreen('ai-tools-screen');
      });
      document.getElementById('feature-content-planner').addEventListener('click', () => {
        switchScreen('content-planner-screen');
      });
      document.getElementById('feature-transcript').addEventListener('click', () => {
        switchScreen('transcript-screen');
      });
      document.getElementById('feature-analytics').addEventListener('click', () => {
        switchScreen('analytics-screen');
      });
      document.getElementById('feature-tag-generator').addEventListener('click', () => {
        switchScreen('tag-generator-screen');
      });
      document.getElementById('feature-idea-generator').addEventListener('click', () => {
        switchScreen('idea-generator-screen');
      });
      
      // --- Metadata Extractor Screen Events ---
      document.getElementById('extractBtn').addEventListener('click', () => {
        extractMetadata();
      });
      document.getElementById('refreshMetadataExtractorBtn').addEventListener('click', () => {
        const videoUrl = document.getElementById('videoUrl').value.trim();
        if (videoUrl) {
          extractMetadata();
        } else {
          showToast('Please enter a video URL first');
        }
      });
      document.getElementById('refreshMetadataResultsBtn').addEventListener('click', () => {
        extractMetadata(); // Re-extracts with current URL
      });

      // --- Watch Video Screen Events ---
      // Search on watch page
      document.getElementById('watchSearchButton').addEventListener('click', () => {
        loadWatchVideoFromSearchInput();
      });
      document.getElementById('watchVideoSearch').addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
            loadWatchVideoFromSearchInput();
        }
      });
      // Load more search results on watch page
      document.getElementById('loadMoreWatchResultsBtn').addEventListener('click', () => {
          const query = document.getElementById('watchVideoSearch').value.trim();
          if (query && watchSearchResultsNextPageToken) {
              searchVideosForWatchScreen(query, true); // Append results
          } else {
              showToast('No more results or empty search query.');
          }
      });
      // Refresh watch page button
      document.getElementById('refreshWatchPageBtn').addEventListener('click', () => {
          document.getElementById('watchVideoSearch').value = '';
          document.getElementById('videoPlayerCard').style.display = 'none';
          document.getElementById('relatedVideosCard').style.display = 'none';
          document.getElementById('watchVideoSearchResults').style.display = 'none';
          document.getElementById('watchSearchResultsContent').innerHTML = '';
          watchSearchResultsNextPageToken = null;
          currentWatchVideoId = null;
          document.getElementById('videoPlayer').src = ''; // Stop current video
          showToast('Watch page reset.');
      });
      // Video action buttons
      document.getElementById('likeBtn').addEventListener('click', () => { showToast('Video liked!'); });
      document.getElementById('dislikeBtn').addEventListener('click', () => { showToast('Video disliked'); });
      document.getElementById('shareBtn').addEventListener('click', () => {
          const videoId = getCurrentWatchVideoId();
          if (videoId) {
            const shareUrl = `https://www.youtube.com/watch?v=${videoId}`;
            navigator.clipboard.writeText(shareUrl)
              .then(() => { showToast('Video URL copied to clipboard'); })
              .catch(err => { showToast('Failed to copy: ' + err); });
          }
      });
      document.getElementById('downloadBtn').addEventListener('click', () => {
        showToast('Starting video download...');
        setTimeout(() => { showToast('Video downloaded successfully!'); }, 2000);
      });
      document.getElementById('saveBtn').addEventListener('click', () => { showToast('Video saved to your library'); });
      // Extract from watch button
      document.getElementById('extractFromWatchBtn').addEventListener('click', () => {
        const videoId = getCurrentWatchVideoId();
        if (videoId) {
          document.getElementById('videoUrl').value = `https://www.youtube.com/watch?v=${videoId}`;
          switchScreen('metadata-extract-screen');
          extractMetadata();
        } else {
          showToast('No video loaded');
        }
      });
      // Show more description
      document.getElementById('showMoreDescBtn').addEventListener('click', () => {
        const descContainer = document.getElementById('watchVideoDescription');
        const btn = document.getElementById('showMoreDescBtn');
        if (descContainer.classList.contains('collapsed')) {
          descContainer.classList.remove('collapsed');
          btn.textContent = 'SHOW LESS';
        } else {
          descContainer.classList.add('collapsed');
          btn.textContent = 'SHOW MORE';
        }
      });

      // --- Common Elements/Global Actions ---
      document.getElementById('mainSearchBtn').addEventListener('click', () => {
          // This global search button is intended to open the watch screen and load video.
          // For simplicity, it will currently just navigate to the watch screen.
          // In a real app, it might open a modal search or use a global input.
          switchScreen('watch-video-screen');
          showToast('Use the search bar on this page to find videos.');
      });
      
      // History
      document.getElementById('clearHistoryBtn').addEventListener('click', () => {
        clearHistory();
      });
      
      // Paste buttons (re-mapped to new IDs where applicable)
      document.getElementById('pasteUrlBtn').addEventListener('click', () => {
        pasteFromClipboard('videoUrl');
      });
      document.getElementById('pasteThumbnailUrlBtn').addEventListener('click', () => {
        pasteFromClipboard('thumbnailUrl');
      });
      document.getElementById('pasteCommentsUrlBtn').addEventListener('click', () => {
        pasteFromClipboard('commentsUrl');
      });
      document.getElementById('pasteTranscriptUrlBtn').addEventListener('click', () => {
        pasteFromClipboard('transcriptUrl');
      });
      // New paste button for watch screen search
      // document.getElementById('pasteWatchUrlBtn').addEventListener('click', () => { pasteFromClipboard('watchVideoSearch'); });

      // Thumbnail quality tabs
      document.querySelectorAll('#thumbnail-screen .tabs-container .tab[data-quality]').forEach(tab => {
        tab.addEventListener('click', () => {
          document.querySelectorAll('#thumbnail-screen .tabs-container .tab[data-quality]').forEach(t => {
            t.classList.remove('active');
          });
          tab.classList.add('active');
          updateThumbnailPreview();
        });
      });
      
      // Transcript format tabs
      document.querySelectorAll('#transcript-screen .tabs-container .tab[data-transcript-format]').forEach(tab => {
        tab.addEventListener('click', () => {
          document.querySelectorAll('#transcript-screen .tabs-container .tab[data-transcript-format]').forEach(t => {
            t.classList.remove('active');
          });
          tab.classList.add('active');
          updateTranscriptFormat(tab.getAttribute('data-transcript-format'));
        });
      });
      
      // AI Tools internal tabs
      document.querySelectorAll('#ai-tools-screen .tabs-container .tab[data-ai-tool]').forEach(tab => {
          tab.addEventListener('click', () => {
              document.querySelectorAll('#ai-tools-screen .tabs-container .tab').forEach(t => t.classList.remove('active'));
              tab.classList.add('active');

              const toolContentId = `ai-${tab.getAttribute('data-ai-tool')}-tool-content`;
              document.querySelectorAll('#ai-tools-screen .tab-content').forEach(c => c.classList.remove('active'));
              document.getElementById(toolContentId).classList.add('active');
              
              // Clear previous results and inputs for the other tool when switching tabs
              document.getElementById('aiToolOutputs').innerHTML = '';
              document.getElementById('aiToolResults').style.display = 'none';
              if (tab.getAttribute('data-ai-tool') === 'description') {
                  document.getElementById('titleTopic').value = '';
              } else {
                  document.getElementById('descriptionTopic').value = '';
                  document.getElementById('descriptionDetails').value = '';
              }
          });
      });


      // Platform selectors (re-scoped to their parent containers)
      document.querySelectorAll('#ai-description-tool-content .platform-selector .platform-item, #ai-title-tool-content .platform-selector .platform-item').forEach(item => {
        item.addEventListener('click', () => {
          const container = item.closest('.platform-selector');
          container.querySelectorAll('.platform-item').forEach(platform => {
            platform.classList.remove('active');
          });
          item.classList.add('active');
        });
      });
      
      // Download thumbnail button
      document.getElementById('downloadThumbnailBtn').addEventListener('click', () => {
        downloadThumbnail();
      });
      
      // Thumbnail URL input
      document.getElementById('thumbnailUrl').addEventListener('input', () => {
        updateThumbnailPreview();
      });
      
      // Get comments button
      document.getElementById('getCommentsBtn').addEventListener('click', () => {
        getVideoComments();
      });
      
      // Get keywords button
      document.getElementById('getKeywordsBtn').addEventListener('click', () => {
        getKeywordSuggestions();
      });
      
      // Filter comments button
      document.getElementById('filterCommentsBtn').addEventListener('click', () => {
        showModal('filterModal');
      });
      
      // Apply filter button
      document.getElementById('applyFilterBtn').addEventListener('click', () => {
        applyCommentsFilter();
        hideModal('filterModal');
      });
      
      // Reset filter button
      document.getElementById('resetFilterBtn').addEventListener('click', () => {
        resetCommentsFilter();
      });
      
      // Close modals
      document.getElementById('closeFilterModal').addEventListener('click', () => {
        hideModal('filterModal');
      });
      
      document.getElementById('closeAddContentModal').addEventListener('click', () => {
        hideModal('addContentModal');
      });
      
      // Load more comments button
      document.getElementById('loadMoreCommentsBtn').addEventListener('click', () => {
        loadMoreComments();
      });
      
      // Theme toggle in settings
      document.getElementById('darkModeToggle').addEventListener('change', (e) => {
        if (e.target.checked) {
          enableDarkMode();
        } else {
          disableDarkMode();
        }
        
        // Save setting
        userData.settings.darkMode = e.target.checked;
        saveUserData();
      });
      
      // High quality thumbnails setting
      document.getElementById('hqThumbnailToggle').addEventListener('change', (e) => {
        userData.settings.hqThumbnail = e.target.checked;
        saveUserData();
      });
      
      // Auto save history setting
      document.getElementById('saveHistoryToggle').addEventListener('change', (e) => {
        userData.settings.saveHistory = e.target.checked;
        saveUserData();
      });
      
      // Autoplay setting
      document.getElementById('autoplayToggle').addEventListener('change', (e) => {
        userData.settings.autoplay = e.target.checked;
        saveUserData();
      });
      
      // Clear data button
      document.getElementById('clearDataBtn').addEventListener('click', () => {
        if (confirm('Are you sure you want to clear all saved data?')) {
          clearAllData();
        }
      });
      
      // Comments search
      document.getElementById('commentsSearch').addEventListener('input', () => {
        searchComments();
      });
      
      // Generate description button
      document.getElementById('generateDescriptionBtn').addEventListener('click', () => {
        generateDescriptions();
      });
      
      // Generate title button
      document.getElementById('generateTitleBtn').addEventListener('click', () => {
        generateTitles();
      });
      
      // Get transcript button
      document.getElementById('getTranscriptBtn').addEventListener('click', () => {
        getTranscript();
      });
      
      // Content planner
      document.getElementById('addContentBtn').addEventListener('click', () => {
        showModal('addContentModal');
        document.getElementById('contentDate').valueAsDate = new Date();
      });
      
      document.getElementById('saveContentBtn').addEventListener('click', () => {
        saveContentItem();
        hideModal('addContentModal');
      });
      
      document.getElementById('cancelAddContentBtn').addEventListener('click', () => {
        hideModal('addContentModal');
      });
      
      document.getElementById('prevMonthBtn').addEventListener('click', () => {
        currentMonth.setMonth(currentMonth.getMonth() - 1);
        generateCalendar();
        updateContentPlannerView();
      });
      
      document.getElementById('nextMonthBtn').addEventListener('click', () => {
        currentMonth.setMonth(currentMonth.getMonth() + 1);
        generateCalendar();
        updateContentPlannerView();
      });
      
      // Contact developer button
      document.getElementById('contactDeveloperBtn').addEventListener('click', () => {
        window.open('mailto:ms2600971@gmail.com?subject=Custom%20Project%20Inquiry&body=Hi%20Mohammed%2C%0A%0AI%20am%20interested%20in%20a%20custom%20project.%20Here%20are%20the%20details%3A%0A%0A', '_blank');
      });
    }
    
    // Setup analytics screen events
    function setupAnalyticsScreenEvents() {
      // Paste button for analytics URL
      document.getElementById('pasteAnalyticsUrlBtn')?.addEventListener('click', () => {
        pasteFromClipboard('analyticsUrl');
      });
      
      // Get analytics button
      document.getElementById('getAnalyticsBtn')?.addEventListener('click', () => {
        getVideoAnalytics();
      });
      
      // Export analytics button
      document.getElementById('exportAnalyticsBtn')?.addEventListener('click', () => {
        exportAnalytics();
      });
      
      // Refresh analytics button
      document.getElementById('refreshAnalyticsBtn')?.addEventListener('click', () => {
        const analyticsUrl = document.getElementById('analyticsUrl').value.trim();
        if (analyticsUrl) {
          getVideoAnalytics();
        } else {
          showToast('Please enter a video URL first');
        }
      });
    }
    
    // Get video analytics
    function getVideoAnalytics() {
      const videoUrl = document.getElementById('analyticsUrl').value.trim();
      const videoId = extractVideoId(videoUrl);
      
      if (!videoId) {
        showToast('Invalid YouTube URL');
        return;
      }
      
      // Show loading
      document.getElementById('analyticsProgress').style.display = 'block';
      document.getElementById('analyticsResults').style.display = 'none';
      
      // Get actual video data
      fetchVideoAnalytics(videoId);
    }
    
    // Fetch video analytics
    function fetchVideoAnalytics(videoId) {
      // Create the YouTube API URL
      const apiUrl = `https://www.googleapis.com/youtube/v3/videos?id=${videoId}&part=statistics&key=${API_KEY}`;
      
      fetch(apiUrl)
        .then(response => {
          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
          return response.json();
        })
        .then(data => {
          if (data.items && data.items.length > 0) {
            // Extract statistics
            const stats = data.items[0].statistics;
            const viewCount = parseInt(stats.viewCount) || 0;
            const likeCount = parseInt(stats.likeCount) || 0;
            const commentCount = parseInt(stats.commentCount) || 0;
            
            // Calculate engagement rate, handling potential division by zero
            const engagementRate = viewCount > 0 ? ((likeCount + commentCount) / viewCount * 100).toFixed(1) : '0.0';
            
            // Update UI
            document.getElementById('analyticsViews').textContent = formatNumber(viewCount);
            document.getElementById('analyticsLikes').textContent = formatNumber(likeCount);
            document.getElementById('analyticsComments').textContent = formatNumber(commentCount);
            document.getElementById('engagementRate').textContent = engagementRate + '%';
            
            // Generate retention graph
            generateRetentionGraph();
            
            // Generate traffic sources
            generateTrafficSources();
            
            // Generate demographics
            generateDemographics();
            
            // Hide loading and show results
            document.getElementById('analyticsProgress').style.display = 'none';
            document.getElementById('analyticsResults').style.display = 'block';
          } else {
            throw new Error('No data found for the provided video ID');
          }
        })
        .catch(error => {
          console.error('Error fetching video analytics:', error);
          showToast('Error fetching video data: ' + error.message);
          document.getElementById('analyticsProgress').style.display = 'none';
        });
    }
    
    // Generate retention graph
    function generateRetentionGraph() {
      const retentionGraph = document.getElementById('retentionGraph');
      retentionGraph.innerHTML = '';
      
      // Create 10 bars for retention data
      for (let i = 0; i < 10; i++) {
        // Higher retention at the beginning, gradually decreasing
        const retention = Math.round(100 - (i * 5) - (Math.random() * 15));
        
        const bar = document.createElement('div');
        bar.style.width = '8%';
        bar.style.height = `${retention}%`;
        bar.style.backgroundColor = 'var(--primary-color)';
        bar.style.borderRadius = '4px 4px 0 0';
        bar.style.position = 'relative';
        
        // Add label
        const label = document.createElement('div');
        label.style.position = 'absolute';
        label.style.top = '-24px';
        label.style.left = '50%';
        label.style.transform = 'translateX(-50%)';
        label.style.fontSize = '10px';
        label.style.color = 'var(--text-secondary)';
        label.textContent = `${retention}%`;
        bar.appendChild(label);
        
        retentionGraph.appendChild(bar);
      }
    }
    
    // Generate traffic sources
    function generateTrafficSources() {
      const trafficSources = document.getElementById('trafficSources');
      trafficSources.innerHTML = '';
      
      const sources = [
        { name: 'YouTube Search', percentage: Math.floor(Math.random() * 30) + 10 },
        { name: 'Suggested Videos', percentage: Math.floor(Math.random() * 30) + 10 },
        { name: 'External', percentage: Math.floor(Math.random() * 20) + 5 },
        { name: 'Browse Features', percentage: Math.floor(Math.random() * 20) + 5 },
        { name: 'Channel Pages', percentage: Math.floor(Math.random() * 10) + 5 }
      ];
      
      // Sort by percentage
      sources.sort((a, b) => b.percentage - a.percentage);
      
      // Calculate others to ensure total is 100%
      let totalPercentage = sources.reduce((acc, source) => acc + source.percentage, 0);
      if (totalPercentage < 100) {
        sources.push({ name: 'Others', percentage: 100 - totalPercentage });
      } else if (totalPercentage > 100) {
        // Distribute excess percentage to top sources or simply cap at 100% if sum exceeds
        let excess = totalPercentage - 100;
        for (let i = 0; i < sources.length && excess > 0; i++) {
            const reduce = Math.min(sources[i].percentage, excess);
            sources[i].percentage -= reduce;
            excess -= reduce;
        }
        // Recalculate to ensure it's exactly 100 for display, might lose tiny precision
        const factor = 100 / sources.reduce((acc, source) => acc + source.percentage, 0);
        sources.forEach(source => source.percentage = Math.round(source.percentage * factor));
      }

      // Create traffic source bars
      sources.forEach(source => {
        const sourceContainer = document.createElement('div');
        sourceContainer.style.marginBottom = '16px';
        
        const sourceLabel = document.createElement('div');
        sourceLabel.style.display = 'flex';
        sourceLabel.style.justifyContent = 'space-between';
        sourceLabel.style.marginBottom = '4px';
        sourceLabel.innerHTML = `
          <span>${source.name}</span>
          <span>${source.percentage}%</span>
        `;
        
        const sourceBar = document.createElement('div');
        sourceBar.style.height = '8px';
        sourceBar.style.width = '100%';
        sourceBar.style.backgroundColor = 'var(--divider-color)';
        sourceBar.style.borderRadius = '4px';
        sourceBar.style.overflow = 'hidden';
        
        const sourceProgress = document.createElement('div');
        sourceProgress.style.height = '100%';
        sourceProgress.style.width = `${source.percentage}%`;
        sourceProgress.style.backgroundColor = 'var(--primary-color)';
        
        sourceBar.appendChild(sourceProgress);
        sourceContainer.appendChild(sourceLabel);
        sourceContainer.appendChild(sourceBar);
        trafficSources.appendChild(sourceContainer);
      });
    }
    
    // Generate demographics
    function generateDemographics() {
      const demographics = document.getElementById('demographics');
      demographics.innerHTML = '';
      
      // Age groups
      const ageGroupsContainer = document.createElement('div');
      ageGroupsContainer.style.marginBottom = '24px';
      
      const ageGroupsTitle = document.createElement('div');
      ageGroupsTitle.style.marginBottom = '12px';
      ageGroupsTitle.style.fontWeight = '500';
      ageGroupsTitle.textContent = 'Age Groups';
      
      const ageGroups = document.createElement('div');
      ageGroups.style.display = 'flex';
      ageGroups.style.justifyContent = 'space-between';
      ageGroups.style.gap = '8px';
      
      const ageData = [
        { age: '13-17', percentage: Math.floor(Math.random() * 15) },
        { age: '18-24', percentage: Math.floor(Math.random() * 20) + 15 },
        { age: '25-34', percentage: Math.floor(Math.random() * 20) + 20 },
        { age: '35-44', percentage: Math.floor(Math.random() * 15) + 10 },
        { age: '45-54', percentage: Math.floor(Math.random() * 10) + 5 },
        { age: '55+', percentage: Math.floor(Math.random() * 10) }
      ];
      
      // Normalize percentages to sum up to 100%
      let totalAgePercentage = ageData.reduce((acc, data) => acc + data.percentage, 0);
      const ageFactor = 100 / totalAgePercentage;
      ageData.forEach(data => data.percentage = Math.round(data.percentage * ageFactor));

      ageData.forEach(data => {
        const ageGroup = document.createElement('div');
        ageGroup.style.flex = '1';
        ageGroup.style.textAlign = 'center';
        
        const ageBar = document.createElement('div');
        ageBar.style.height = '80px';
        ageBar.style.display = 'flex';
        ageBar.style.flexDirection = 'column';
        ageBar.style.justifyContent = 'flex-end';
        
        const ageBarFill = document.createElement('div');
        ageBarFill.style.backgroundColor = 'var(--primary-color)';
        ageBarFill.style.width = '100%';
        ageBarFill.style.height = `${data.percentage}%`;
        ageBarFill.style.borderRadius = '4px 4px 0 0';
        
        const ageLabel = document.createElement('div');
        ageLabel.style.marginTop = '8px';
        ageLabel.style.fontSize = '12px';
        ageLabel.style.color = 'var(--text-secondary)';
        ageLabel.textContent = data.age;
        
        const agePercentage = document.createElement('div');
        agePercentage.style.fontSize = '12px';
        agePercentage.style.fontWeight = '500';
        agePercentage.textContent = `${data.percentage}%`;
        
        ageBar.appendChild(ageBarFill);
        ageGroup.appendChild(ageBar);
        ageGroup.appendChild(agePercentage);
        ageGroup.appendChild(ageLabel);
        ageGroups.appendChild(ageGroup);
      });
      
      ageGroupsContainer.appendChild(ageGroupsTitle);
      ageGroupsContainer.appendChild(ageGroups);
      demographics.appendChild(ageGroupsContainer);
      
      // Gender distribution
      const genderContainer = document.createElement('div');
      
      const genderTitle = document.createElement('div');
      genderTitle.style.marginBottom = '12px';
      genderTitle.style.fontWeight = '500';
      genderTitle.textContent = 'Gender';
      
      const genderChart = document.createElement('div');
      genderChart.style.display = 'flex';
      genderChart.style.height = '24px';
      genderChart.style.borderRadius = '4px';
      genderChart.style.overflow = 'hidden';
      
      // Random gender distribution
      const malePercentage = Math.floor(Math.random() * 50) + 25;
      const femalePercentage = 100 - malePercentage;
      
      const maleBar = document.createElement('div');
      maleBar.style.width = `${malePercentage}%`;
      maleBar.style.backgroundColor = 'var(--primary-color)';
      maleBar.style.display = 'flex';
      maleBar.style.alignItems = 'center';
      maleBar.style.justifyContent = 'center';
      maleBar.style.color = 'white';
      maleBar.style.fontSize = '12px';
      maleBar.textContent = `${malePercentage}%`;
      
      const femaleBar = document.createElement('div');
      femaleBar.style.width = `${femalePercentage}%`;
      femaleBar.style.backgroundColor = 'var(--accent-color)';
      femaleBar.style.display = 'flex';
      femaleBar.style.alignItems = 'center';
      femaleBar.style.justifyContent = 'center';
      femaleBar.style.color = 'white';
      femaleBar.style.fontSize = '12px';
      femaleBar.textContent = `${femalePercentage}%`;
      
      genderChart.appendChild(maleBar);
      genderChart.appendChild(femaleBar);
      
      const genderLabels = document.createElement('div');
      genderLabels.style.display = 'flex';
      genderLabels.style.justifyContent = 'space-around';
      genderLabels.style.marginTop = '8px';
      genderLabels.style.fontSize = '12px';
      genderLabels.style.color = 'var(--text-secondary)';
      genderLabels.innerHTML = `
        <div><span style="display: inline-block; width: 10px; height: 10px; background-color: var(--primary-color); margin-right: 4px;"></span> Male</div>
        <div><span style="display: inline-block; width: 10px; height: 10px; background-color: var(--accent-color); margin-right: 4px;"></span> Female</div>
      `;
      
      genderContainer.appendChild(genderTitle);
      genderContainer.appendChild(genderChart);
      genderContainer.appendChild(genderLabels);
      demographics.appendChild(genderContainer);
    }
    
    // Export analytics
    function exportAnalytics() {
      const viewCount = document.getElementById('analyticsViews').textContent;
      const likeCount = document.getElementById('analyticsLikes').textContent;
      const commentCount = document.getElementById('analyticsComments').textContent;
      const engagementRate = document.getElementById('engagementRate').textContent;
      
      const analyticsData = {
        statistics: {
          viewCount,
          likeCount,
          commentCount,
          engagementRate
        },
        exported: new Date().toISOString()
      };
      
      const jsonString = JSON.stringify(analyticsData, null, 2);
      const blob = new Blob([jsonString], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      
      const a = document.createElement('a');
      a.href = url;
      a.download = 'video_analytics.json';
      a.click();
      
      showToast('Analytics exported');
    }
    
    // Setup tag generator events
    function setupTagGeneratorEvents() {
      // Generate tags button
      document.getElementById('generateTagsBtn')?.addEventListener('click', () => {
        generateTags();
      });
      
      // Regenerate tags button
      document.getElementById('regenerateTagsBtn')?.addEventListener('click', () => {
        generateTags();
      });

      document.getElementById('refreshTagGenBtn')?.addEventListener('click', () => {
        document.getElementById('tagTopic').value = '';
        document.getElementById('tagCount').value = '20';
        document.getElementById('tagGenResults').style.display = 'none';
        document.getElementById('generatedTagsContainer').innerHTML = '';
        document.getElementById('generatedTagsList').textContent = '';
      });
    }
    
    // Generate tags
    function generateTags() {
      const topic = document.getElementById('tagTopic').value.trim();
      const count = parseInt(document.getElementById('tagCount').value) || 20;
      
      if (!topic) {
        showToast('Please enter a video topic');
        return;
      }
      
      // Validate count
      const tagCount = Math.min(Math.max(count, 5), 30);
      
      // Show loading
      document.getElementById('tagGenProgress').style.display = 'block';
      document.getElementById('tagGenResults').style.display = 'none';
      
      // Simulate API response
      setTimeout(() => {
        // Hide loading
        document.getElementById('tagGenProgress').style.display = 'none';
        
        // Generate tags
        const tags = generateTagsForTopic(topic, tagCount);
        
        // Update UI
        const tagsContainer = document.getElementById('generatedTagsContainer');
        tagsContainer.innerHTML = '';
        
        tags.forEach(tag => {
          const tagElement = document.createElement('div');
          tagElement.className = 'tag';
          tagElement.innerHTML = `
            ${tag}
            <i class="fas fa-copy" onclick="copyTagToClipboard('${tag.replace(/'/g, "\\'")}')"></i>
          `;
          tagsContainer.appendChild(tagElement);
        });
        
        document.getElementById('generatedTagsList').textContent = tags.join(', ');
        
        // Show results
        document.getElementById('tagGenResults').style.display = 'block';
      }, 1500);
    }
    
    // Generate tags for topic
    function generateTagsForTopic(topic, count) {
      const baseKeywords = [
        'tutorial', 'guide', 'how to', 'tips', 'tricks', 'beginner', 'advanced',
        'review', 'best', 'top', 'comparison', 'vs', 'alternative', 'cheap',
        'free', 'premium', 'professional', 'easy', 'quick', 'simple',
        '2024', '2025', 'new', 'latest', 'updated', 'trending', 'viral',
        'ultimate', 'complete', 'comprehensive', 'step by step', 'explained',
        'for beginners', 'for experts', 'masterclass', 'course', 'lesson',
        'hack', 'secret', 'hidden', 'unknown', 'revealed', 'exposed',
        'what is', 'how does', 'why you should', 'why you need'
      ];
      
      // Split topic into words
      const topicWords = topic.toLowerCase().split(/\s+/).filter(word => word.length > 2);
      
      // Generate base tags from topic
      const tags = [...new Set([topic])]; // Start with unique topic
      
      // Add variations of the topic
      if (tags.length < count) tags.push(`${topic} tutorial`);
      if (tags.length < count) tags.push(`how to ${topic}`);
      if (tags.length < count) tags.push(`${topic} guide`);
      if (tags.length < count) tags.push(`best ${topic}`);
      if (tags.length < count) tags.push(`${topic} tips`);
      if (tags.length < count) tags.push(`${topic} for beginners`);
      if (tags.length < count) tags.push(`${topic} 2024`);
      
      // Add combinations using topic words and base keywords
      for (let i = 0; tags.length < count && i < (count * 2); i++) { // Attempt to generate more than needed
          const randomBase = baseKeywords[Math.floor(Math.random() * baseKeywords.length)];
          const randomTopicWord = topicWords[Math.floor(Math.random() * topicWords.length)];

          let newTag;
          if (Math.random() > 0.5 && randomTopicWord) {
              newTag = `${randomTopicWord} ${randomBase}`;
          } else {
              newTag = `${topic} ${randomBase}`;
          }
          newTag = newTag.toLowerCase().trim(); // Ensure lowercase and trim

          if (!tags.includes(newTag)) {
              tags.push(newTag);
          }
      }
      
      // Return unique keywords and trim to requested count
      return [...new Set(tags)].slice(0, count);
    }
    
    // Export generated tags
    function exportGeneratedTags() {
      const tagsContent = document.getElementById('generatedTagsList').textContent;
      
      if (!tagsContent || tagsContent.trim() === '') {
        showToast('No tags available');
        return;
      }
      
      const blob = new Blob([tagsContent], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      
      const a = document.createElement('a');
      a.href = url;
      a.download = 'youtube_tags.txt';
      a.click();
      
      showToast('Tags exported');
    }
    
    // Setup idea generator events
    function setupIdeaGeneratorEvents() {
      // Generate ideas button
      document.getElementById('generateIdeasBtn')?.addEventListener('click', () => {
        generateVideoIdeas();
      });
      
      // Regenerate ideas button
      document.getElementById('regenerateIdeasBtn')?.addEventListener('click', () => {
        generateVideoIdeas();
      });

      document.getElementById('refreshIdeasBtn')?.addEventListener('click', () => {
        document.getElementById('ideaNiche').value = '';
        document.getElementById('ideaCount').value = '10';
        document.getElementById('ideasResults').style.display = 'none';
        document.getElementById('ideasContainer').innerHTML = '';
      });
    }
    
    // Generate video ideas
    function generateVideoIdeas() {
      const niche = document.getElementById('ideaNiche').value.trim();
      const count = parseInt(document.getElementById('ideaCount').value) || 10;
      
      if (!niche) {
        showToast('Please enter a niche/topic');
        return;
      }
      
      // Show loading
      document.getElementById('ideasProgress').style.display = 'block';
      document.getElementById('ideasResults').style.display = 'none';
      
      // Simulate API response
      setTimeout(() => {
        // Hide loading
        document.getElementById('ideasProgress').style.display = 'none';
        
        // Generate ideas
        const ideas = generateIdeasForNiche(niche, count);
        
        // Update UI
        const ideasContainer = document.getElementById('ideasContainer');
        ideasContainer.innerHTML = '';
        
        ideas.forEach((idea, index) => {
          const ideaElement = document.createElement('div');
          ideaElement.className = 'output-item';
          ideaElement.innerHTML = `
            <div style="font-weight: 500; margin-bottom: 8px; display: flex; align-items: center; gap: 8px;">
              <span style="background-color: var(--primary-color); color: white; width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px;">${index + 1}</span>
              <span>${idea.title}</span>
            </div>
            <div style="color: var(--text-secondary); font-size: 14px; margin-bottom: 8px;">${idea.description}</div>
            <div class="output-actions">
              <button class="material-btn" onclick="copyIdeaToClipboard(this)">
                <i class="fas fa-copy me-1"></i> Copy
              </button>
              <button class="material-btn" onclick="addIdeaToPlanner('${idea.title.replace(/'/g, "\\'")}')">
                <i class="fas fa-calendar-plus me-1"></i> Add to Planner
              </button>
            </div>
          `;
          ideasContainer.appendChild(ideaElement);
        });
        
        // Show results
        document.getElementById('ideasResults').style.display = 'block';
      }, 1500);
    }
    
    // Generate ideas for niche
    function generateIdeasForNiche(niche, count) {
      const templates = [
        {
          title: "10 Essential {niche} Tips for Beginners",
          description: "Share fundamental tips that newcomers to {niche} need to know to get started on the right foot."
        },
        {
          title: "The Ultimate {niche} Buyer's Guide",
          description: "Help viewers make informed purchasing decisions by comparing different products or services in the {niche} space."
        },
        {
          title: "I Tried {niche} for 30 Days - Here's What Happened",
          description: "Document a personal challenge related to {niche} and share the journey, results, and lessons learned."
        },
        {
          title: "5 Common {niche} Mistakes (And How to Avoid Them)",
          description: "Highlight frequent errors that people make in {niche} and provide practical solutions."
        },
        {
          title: "How I Made $1000 with {niche} (Step-by-Step)",
          description: "Share a monetization strategy related to {niche} and walk viewers through the process."
        },
        {
          title: "{niche} Hacks That Will Change Your Life",
          description: "Showcase clever shortcuts, tricks, and unconventional methods that yield great results in {niche}."
        },
        {
          title: "The Truth About {niche} Nobody Tells You",
          description: "Reveal insider information, debunk myths, or share little-known facts about {niche}."
        },
        {
          title: "Budget vs Premium: {niche} Edition",
          description: "Compare affordable and high-end options in {niche} to help viewers decide where to invest their money."
        },
        {
          title: "Day in the Life of a {niche} Professional",
          description: "Provide a behind-the-scenes look at what it's really like to work in the {niche} field."
        },
        {
          title: "{niche} Trends to Watch in 2024",
          description: "Highlight upcoming trends, innovations, or changes in the {niche} landscape that viewers should know about."
        },
        {
          title: "How to Create the Perfect {niche} Setup",
          description: "Guide viewers through creating an optimal environment, workspace, or system for {niche} activities."
        },
        {
          title: "Is {niche} Worth It in 2024?",
          description: "Evaluate the current value, relevance, and potential of {niche} to help viewers decide if they should pursue it."
        },
        {
          title: "I Tested the Top 5 {niche} Products So You Don't Have To",
          description: "Share your experience testing multiple popular products in the {niche} category and provide recommendations."
        },
        {
          title: "From Beginner to Pro: {niche} Progression Timeline",
          description: "Show the typical learning curve and development stages in {niche}, with examples at each level."
        },
        {
          title: "What No One Tells You About Starting a {niche} Channel",
          description: "Share insights about creating content specifically in the {niche} category on YouTube."
        },
        {
          title: "{niche} Challenge: Can I Master It in One Week?",
          description: "Document an intensive learning experience trying to quickly develop skills in {niche}."
        },
        {
          title: "How {niche} Has Changed in the Last Decade",
          description: "Provide historical context and evolution of {niche} over time, highlighting key developments."
        },
        {
          title: "The Science Behind Successful {niche}",
          description: "Explain the research, principles, or technical aspects that contribute to success in {niche}."
        },
        {
          title: "{niche} Q&A: Answering Your Most Asked Questions",
          description: "Address common questions and misconceptions about {niche} based on viewer comments or search trends."
        },
        {
          title: "I Quit {niche} for a Month - Here's What I Learned",
          description: "Share insights from taking a break from {niche} and what the experience revealed."
        }
      ];
      
      // Shuffle templates
      const shuffledTemplates = [...templates].sort(() => 0.5 - Math.random());
      
      // Take requested number of templates
      const selectedTemplates = shuffledTemplates.slice(0, count);
      
      // Fill in the niche
      return selectedTemplates.map(template => {
        return {
          title: template.title.replace(/{niche}/g, niche),
          description: template.description.replace(/{niche}/g, niche)
        };
      });
    }
    
    // Copy idea to clipboard
    function copyIdeaToClipboard(button) {
      const idea = button.parentNode.parentNode.querySelector('span:nth-child(2)').textContent;
      
      navigator.clipboard.writeText(idea)
        .then(() => {
          showToast('Idea copied to clipboard');
        })
        .catch(err => {
          showToast('Failed to copy idea');
        });
    }
    
    // Add idea to planner
    function addIdeaToPlanner(title) {
      // Switch to planner screen
      switchScreen('content-planner-screen');
      
      // Open add content modal
      showModal('addContentModal');
      
      // Set title and date
      document.getElementById('contentTitle').value = title;
      document.getElementById('contentDate').valueAsDate = new Date();
      
      showToast('Added to content planner');
    }
    
    // Export ideas
    function exportIdeas() {
      const ideasContainer = document.getElementById('ideasContainer');
      
      if (!ideasContainer || !ideasContainer.children.length) {
        showToast('No ideas available');
        return;
      }
      
      // Create text content from ideas
      let content = 'VIDEO IDEAS:\n\n';
      
      Array.from(ideasContainer.children).forEach((idea, index) => {
        const title = idea.querySelector('span:nth-child(2)').textContent;
        const description = idea.querySelector('div:nth-child(2)').textContent;
        
        content += `${index + 1}. ${title}\n`;
        content += `   ${description}\n\n`;
      });
      
      const blob = new Blob([content], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      
      const a = document.createElement('a');
      a.href = url;
      a.download = 'video_ideas.txt';
      a.click();
      
      showToast('Ideas exported');
    }
  </script>
</body>
</html>
--- END OF FILE index.html ---